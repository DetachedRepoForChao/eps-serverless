<div class="index-page" >

  <app-navigation></app-navigation>
  <div class="wrapper">
    <section class="section section-lg section-coins">

      <img src="../../../assets/img/path3.png" class="path position-fixed">
      <div class="container align-items-center">

        <div class="row purchase-request-row">
          <div class="col-lg-12 col-md-6 col-sm-10 ml-auto mr-auto" id="confirmRequest">
            <ng-container *ngIf="managerRequests && users; else storeLoading">
            <div class="card">
              <div class="card card-coin card-plain card-custom">
                <div class="card-body">


                  <div class="row">
                    <div class="col-md-12 text-center">
                      <h3> Manage Employee Purchases</h3>
<!--                      <span> Confirm Purchase Request</span>-->
                    </div>
                  </div>
                  <div class="row tab-row">
                    <div class="col-3 text-center" ngClass.lt-sm="font-size-smlr">
                      <span class="tab-item toggled" (click)="filterDataSourceByStatus('allActive'); onTabItemClick('allActive')" id="confirmItemPurchaseTab_allActive">All Active</span>
                    </div>
                    <div class="col-3 text-center" ngClass.lt-sm="font-size-smlr">
                      <span class="tab-item" (click)="filterDataSourceByStatus('readyForPickup'); onTabItemClick('readyForPickup')" id="confirmItemPurchaseTab_readyForPickup">Ready for Pickup</span>
                    </div>
                    <div class="col-3 text-center" ngClass.lt-sm="font-size-smlr">
                      <span class="tab-item" (click)="filterDataSourceByStatus('pickedUp'); onTabItemClick('pickedUp')" id="confirmItemPurchaseTab_pickedUp">Picked Up</span>
                    </div>
<!--                    <div class="col-2 text-center">
                      <span class="tab-item" (click)="filterDataSourceByStatus('cancelled'); onTabItemClick('cancelled')" id="confirmItemPurchaseTab_cancelled">Cancelled</span>
                    </div>-->
                    <div class="col-3 text-center" ngClass.lt-sm="font-size-smlr">
                      <span class="tab-item" (click)="filterDataSourceByStatus('archived'); onTabItemClick('archived')" id="confirmItemPurchaseTab_archived">Archived</span>
                    </div>
                  </div>

                  <div fxShow fxHide.lt-sm class="table-container mat-elevation-z8">
                    <table mat-table  #requestTable [dataSource]="managerRequests"  >
                        <ng-container matColumnDef="createdAt">
                          <th mat-header-cell *matHeaderCellDef  >Activity</th>
                          <td mat-cell *matCellDef="let UserHasStoreItemModel">
                            <div class="col-12">
                              <div class="row">
                                Created On: {{UserHasStoreItemModel.createdAt | date:'shortDate'}}
                              </div>
                              <ng-container *ngIf="UserHasStoreItemModel.createdAt !== UserHasStoreItemModel.updatedAt">
                                <div  class="row font-italic">
                                  Updated On: {{UserHasStoreItemModel.updatedAt | date:'shortDate'}}
                                </div>
                              </ng-container>

                            </div>
<!--                            {{UserHasStoreItemModel.createdAt | date:'longDate'}}-->
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="userUsername">
                          <th mat-header-cell *matHeaderCellDef > Employee Details</th>
                          <td mat-cell *matCellDef="let UserHasStoreItemModel">
                            <div class="col-12">
                              <div class="row">
                                <div class="col-4 img-col">
                                  <img class="rounded-circle avatar-img" [src]="userQuery.getUserByUserId(UserHasStoreItemModel.userId)?.avatarResolvedUrl">
                                </div>
                                <div class="col-8">
                                  <div class="row">
                                    <a href="javascript:void(0)" (click)="onUserClick(UserHasStoreItemModel.userId)">{{UserHasStoreItemModel.userFirstName}} {{UserHasStoreItemModel.userLastName}}</a>
                                  </div>
                                  <div class="row font-italic">
                                    {{userQuery.getUserByUserId(UserHasStoreItemModel.userId)?.department.Name}}
                                  </div>
                                </div>
                              </div>
                            </div>



                          </td>
                        </ng-container>

                        <ng-container matColumnDef=storeItemName>
                          <th mat-header-cell *matHeaderCellDef > Item </th>
                          <td mat-cell *matCellDef="let UserHasStoreItemModel">
                            <div class="col-12">
                              <div class="row">
                                <div class="col-4 img-col">
                                  <img class="avatar-img" [src]="storeItemQuery.getStoreItemById(UserHasStoreItemModel.storeItemId)?.imageResolvedUrl">
                                </div>
                                <div class="col-8">
                                  <div class="row">
                                    {{UserHasStoreItemModel.storeItemName}}
                                  </div>
                                  <div class="row font-italic">
                                    Cost: {{UserHasStoreItemModel.storeItemCost}}üçç
                                  </div>
                                </div>
                              </div>
                            </div>
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="status">
                          <th mat-header-cell *matHeaderCellDef > Status </th>
                          <td mat-cell *matCellDef="let UserHasStoreItemModel">
                            <ng-container *ngIf="UserHasStoreItemModel.status === 'pending'">
                              <div class="pending-style" >
                                {{UserHasStoreItemModel.status | uppercase}}
                              </div>

                            </ng-container>
<!--                            <div *ngIf="UserHasStoreItemModel.status === 'approved'" class="approved-style">
                              {{UserHasStoreItemModel.status | uppercase}}
                            </div>-->
                            <ng-container *ngIf="UserHasStoreItemModel.status === 'readyForPickup'" >
                              <div class="approved-style">
                                READY FOR PICKUP
                              </div>
                            </ng-container>
<!--                            <div *ngIf="UserHasStoreItemModel.status === 'declined'" class="cancelled-style">
                              {{UserHasStoreItemModel.status | uppercase}}
                            </div>
                            <div *ngIf="UserHasStoreItemModel.status === 'cancelled'" class="cancelled-style">
                              {{UserHasStoreItemModel.status | uppercase}}
                            </div>
                            <div *ngIf="UserHasStoreItemModel.status === 'fulfilled'" class="fulfilled-style">
                              {{UserHasStoreItemModel.status | uppercase}}
                            </div>-->
                            <ng-container *ngIf="UserHasStoreItemModel.status === 'pickedUp'" >
                              <div class="fulfilled-style">
                                PICKED UP!
                              </div>
                            </ng-container>

                          </td>
                        </ng-container>

                        <ng-container matColumnDef="action">
                          <th mat-header-cell *matHeaderCellDef> Set Next Status </th>
                          <td mat-cell *matCellDef="let UserHasStoreItemModel" >
                            <ng-container *ngIf="UserHasStoreItemModel.status === 'pending'">
                              <div>
                                <mat-checkbox [value]="'readyForPickup'" (change)="actionToggle(UserHasStoreItemModel, $event)">Ready for Pickup?</mat-checkbox>
                              </div>
                            </ng-container>
<!--                            <div *ngIf="UserHasStoreItemModel.status === 'approved'" >
                              <mat-checkbox [value]="'Fulfill'" (change)="actionToggle(UserHasStoreItemModel, $event)">Fulfill</mat-checkbox>
                            </div>-->
                            <ng-container *ngIf="UserHasStoreItemModel.status === 'readyForPickup'" >
                              <div>
                                <mat-checkbox [value]="'pickedUp'" (change)="actionToggle(UserHasStoreItemModel, $event)">Picked Up?</mat-checkbox>
                              </div>
                            </ng-container>
<!--                            <div *ngIf="UserHasStoreItemModel.status === 'declined' || UserHasStoreItemModel.status === 'cancelled'">
                            </div>
                            <div *ngIf="UserHasStoreItemModel.status === 'fulfilled'">
                            </div>-->

                          </td>
                        </ng-container>




                      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>


                    </table>
                  </div>

<!--                  Mobile Layout-->
                  <perfect-scrollbar id="confirm-item-purchase-scrollbar" class="scroll-container" [config]="config" [scrollIndicators]="true">
                    <div fxHide fxShow.lt-sm class="mat-elevation-z8">
                      <ng-container  *ngFor="let request of managerRequests">
                        <div class="purchase-list-item">
                          <div class="flex-container" fxLayout="row wrap">
                            <div fxFlex="100%" class="text-center pb-2">
                              <div fxFlex="3 0 auto" fxLayoutAlign="center center">
                                <img class="avatar-img rounded-circle" [src]="userQuery.getUserByUserId(request.userId)?.avatarResolvedUrl">
                              </div>
                              <div fxFlex="6 0 auto" class="text-left pl-2">
                                <div class="text-dark text-left font-size-s "><span class="font-weight-bold pr-2">{{request.storeItemName}}</span> <span>{{request.storeItemCost}}üçç</span></div>
                                <a href="javascript:void(0)" class="text-left font-size-s " (click)="onUserClick(request.userId)">{{request.userFirstName}} {{request.userLastName}}</a>
                                <div class="text-dark text-left font-size-s font-italic">{{userQuery.getUserByUserId(request.userId)?.department.Name}}</div>
                              </div>
                              <div fxFlex="3 0 auto" class="text-center" fxLayoutAlign="center center">
                                <img class="avatar-img" [src]="storeItemQuery.getStoreItemById(request.storeItemId)?.imageResolvedUrl">
                              </div>
                            </div>

                            <div fxFlex="100%">
                              <mat-divider ></mat-divider>
                            </div>

                            <div fxFlex="100%" class="flex-container" fxLayout="row wrap">

                              <div fxFlex="60%" class="text-left">

                                <div class="text-dark font-size-s">Create {{request.createdAt | date: 'short'}}</div>
                                <ng-container *ngIf="request.updatedAt">
                                  <div class="text-dark font-size-s">Updated {{request.updatedAt | date: 'short'}}</div>
                                </ng-container>
                                <span class="text-dark font-size-s">Status: </span>
                                <ng-container *ngIf="request.status === 'pending'">
                                <span class="pending-style" >
                                  {{request.status | uppercase}}
                                </span>
                                </ng-container>
                                <ng-container *ngIf="request.status === 'readyForPickup'" >
                                <span class="approved-style">
                                  READY FOR PICKUP
                                </span>
                                </ng-container>
                                <ng-container *ngIf="request.status === 'pickedUp'" >
                                <span class="fulfilled-style">
                                  PICKED UP!
                                </span>
                                </ng-container>
                              </div>
                              <div fxFlex="40%" class="text-left">
                                <div class="text-dark font-size-s">Next Action</div>
                                <ng-container *ngIf="request.status === 'pending'">
                                  <mat-checkbox [value]="'readyForPickup'" (change)="actionToggle(request, $event)">Ready for Pickup?</mat-checkbox>
                                </ng-container>

                                <ng-container *ngIf="request.status === 'readyForPickup'" >
                                  <mat-checkbox [value]="'pickedUp'" (change)="actionToggle(request, $event)">Picked Up?</mat-checkbox>
                                </ng-container>

                              </div>
                            </div>




                          </div>
                        </div>

                      </ng-container>
                    </div>
                  </perfect-scrollbar>




                  <div class="container text-center">
                    <button type="button" class="btn btn-primary mx-3" ngClass.lt-sm="btn-sm" (click)="openDialog()" >Save</button>
                    <button type="button" class="btn btn-danger mx-3" ngClass.lt-sm="btn-sm" (click)="cancelApproval()" >Cancel</button>
                  </div>

                </div>
              </div>


            </div>

            </ng-container>

            <ng-template #storeLoading>
              Loading...
            </ng-template>
          </div>


        </div>




      </div>

    </section>

  </div>
</div>

