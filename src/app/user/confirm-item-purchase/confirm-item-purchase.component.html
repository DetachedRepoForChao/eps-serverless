<div class="index-page" >

  <app-navigation></app-navigation>
  <div class="wrapper">
    <section class="section section-lg section-coins">

      <img src="../../../assets/img/path3.png" class="path position-fixed">
      <div class="container align-items-center">

        <div class="row purchase-request-row">
          <div class="col-lg-12 col-md-6 col-sm-10 ml-auto mr-auto" id="confirmRequest">
            <ng-container *ngIf="managerRequests; else storeLoading">
            <div class="card">
              <div class="card card-coin card-plain card-custom">
                <div class="card-body">


                  <div class="row">
                    <div class="col-md-12 text-center">
                      <h3> Manage Employee Points Purchases</h3>
<!--                      <span> Confirm Purchase Request</span>-->
                    </div>
                  </div>
                  <div class="row tab-row">
                    <div class="col-2 text-center"></div>
                    <div class="col-2 text-center">
                      <span class="tab-item toggled" (click)="filterDataSourceByStatus('allActive'); onTabItemClick('allActive')" id="confirmItemPurchaseTab_allActive">All Active</span>
                    </div>
                    <div class="col-2 text-center">
                      <span class="tab-item" (click)="filterDataSourceByStatus('readyForPickup'); onTabItemClick('readyForPickup')" id="confirmItemPurchaseTab_readyForPickup">Ready for Pickup</span>
                    </div>
                    <div class="col-2 text-center">
                      <span class="tab-item" (click)="filterDataSourceByStatus('pickedUp'); onTabItemClick('pickedUp')" id="confirmItemPurchaseTab_pickedUp">Picked Up</span>
                    </div>
<!--                    <div class="col-2 text-center">
                      <span class="tab-item" (click)="filterDataSourceByStatus('cancelled'); onTabItemClick('cancelled')" id="confirmItemPurchaseTab_cancelled">Cancelled</span>
                    </div>-->
                    <div class="col-2 text-center">
                      <span class="tab-item" (click)="filterDataSourceByStatus('archived'); onTabItemClick('archived')" id="confirmItemPurchaseTab_archived">Archived</span>
                    </div>
                  </div>

                  <div class="table-container mat-elevation-z8">
                    <table mat-table  #requestTable [dataSource]="managerRequests"  >
                        <ng-container matColumnDef="createdAt">
                          <th mat-header-cell *matHeaderCellDef  >Activity</th>
                          <td mat-cell *matCellDef="let UserHasStoreItemModel">
                            <div class="col-12">
                              <div class="row">
                                Created On: {{UserHasStoreItemModel.createdAt | date:'shortDate'}}
                              </div>
                              <div *ngIf="UserHasStoreItemModel.createdAt !== UserHasStoreItemModel.updatedAt" class="row font-italic">
                                Updated On: {{UserHasStoreItemModel.updatedAt | date:'shortDate'}}
                              </div>
                            </div>
<!--                            {{UserHasStoreItemModel.createdAt | date:'longDate'}}-->
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="userUsername">
                          <th mat-header-cell *matHeaderCellDef > Employee Details</th>
                          <td mat-cell *matCellDef="let UserHasStoreItemModel">
                            <div class="col-12">
                              <div class="row">
                                <div class="col-4 img-col">
                                  <img class="rounded-circle avatar-img" [src]="entityUserQuery.getUserByUserId(UserHasStoreItemModel.userId)?.avatarResolvedUrl">
                                </div>
                                <div class="col-8">
                                  <div class="row">
                                    <a href="javascript:void(0)" (click)="onUserClick(UserHasStoreItemModel.userId)">{{UserHasStoreItemModel.userFirstName}} {{UserHasStoreItemModel.userLastName}}</a>
                                  </div>
                                  <div class="row font-italic">
                                    {{entityUserQuery.getUserByUserId(UserHasStoreItemModel.userId)?.department.Name}}
                                  </div>
                                </div>
                              </div>
                            </div>



                          </td>
                        </ng-container>

                        <ng-container matColumnDef=storeItemName>
                          <th mat-header-cell *matHeaderCellDef > Item </th>
                          <td mat-cell *matCellDef="let UserHasStoreItemModel">
                            <div class="col-12">
                              <div class="row">
                                <div class="col-4 img-col">
                                  <img class="avatar-img" [src]="storeItemQuery.getStoreItemById(UserHasStoreItemModel.storeItemId)?.imageResolvedUrl">
                                </div>
                                <div class="col-8">
                                  <div class="row">
                                    {{UserHasStoreItemModel.storeItemName}}
                                  </div>
                                  <div class="row font-italic">
                                    Cost: {{UserHasStoreItemModel.storeItemCost}}pts
                                  </div>
                                </div>
                              </div>
                            </div>
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="status">
                          <th mat-header-cell *matHeaderCellDef > Status </th>
                          <td mat-cell *matCellDef="let UserHasStoreItemModel">
                            <ng-container *ngIf="UserHasStoreItemModel.status === 'pending'">
                              <div class="pending-style" >
                                {{UserHasStoreItemModel.status | uppercase}}
                              </div>

                            </ng-container>
<!--                            <div *ngIf="UserHasStoreItemModel.status === 'approved'" class="approved-style">
                              {{UserHasStoreItemModel.status | uppercase}}
                            </div>-->
                            <ng-container *ngIf="UserHasStoreItemModel.status === 'readyForPickup'" >
                              <div class="approved-style">
                                READY FOR PICKUP
                              </div>
                            </ng-container>
<!--                            <div *ngIf="UserHasStoreItemModel.status === 'declined'" class="cancelled-style">
                              {{UserHasStoreItemModel.status | uppercase}}
                            </div>
                            <div *ngIf="UserHasStoreItemModel.status === 'cancelled'" class="cancelled-style">
                              {{UserHasStoreItemModel.status | uppercase}}
                            </div>
                            <div *ngIf="UserHasStoreItemModel.status === 'fulfilled'" class="fulfilled-style">
                              {{UserHasStoreItemModel.status | uppercase}}
                            </div>-->
                            <ng-container *ngIf="UserHasStoreItemModel.status === 'pickedUp'" >
                              <div class="fulfilled-style">
                                PICKED UP!
                              </div>
                            </ng-container>

                          </td>
                        </ng-container>

                        <ng-container matColumnDef="action">
                          <th mat-header-cell *matHeaderCellDef> Set Next Status </th>
                          <td mat-cell *matCellDef="let UserHasStoreItemModel" >
                            <ng-container *ngIf="UserHasStoreItemModel.status === 'pending'">
                              <div>
                                <mat-checkbox [value]="'readyForPickup'" (change)="actionToggle(UserHasStoreItemModel, $event)">Ready for Pickup?</mat-checkbox>
                              </div>
                            </ng-container>
<!--                            <div *ngIf="UserHasStoreItemModel.status === 'approved'" >
                              <mat-checkbox [value]="'Fulfill'" (change)="actionToggle(UserHasStoreItemModel, $event)">Fulfill</mat-checkbox>
                            </div>-->
                            <ng-container *ngIf="UserHasStoreItemModel.status === 'readyForPickup'" >
                              <div>
                                <mat-checkbox [value]="'pickedUp'" (change)="actionToggle(UserHasStoreItemModel, $event)">Picked Up?</mat-checkbox>
                              </div>
                            </ng-container>
<!--                            <div *ngIf="UserHasStoreItemModel.status === 'declined' || UserHasStoreItemModel.status === 'cancelled'">
                            </div>
                            <div *ngIf="UserHasStoreItemModel.status === 'fulfilled'">
                            </div>-->

                          </td>
                        </ng-container>




                      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>


                    </table>
                  </div>

                  <div class="container text-right">
                    <button type="button" class="btn btn-primary mx-3" (click)="openDialog()" >Save</button>
                    <button type="button" class="btn btn-danger mx-3" (click)="cancelApproval()" >Cancel</button>
                  </div>

                </div>
              </div>


            </div>

            </ng-container>

            <ng-template #storeLoading>
              Loading...
            </ng-template>
          </div>


        </div>




      </div>

    </section>

  </div>
</div>

