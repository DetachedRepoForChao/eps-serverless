<div class="card">
  <h5 class="card-header3">
    <img alt="Bootstap Image Preview" width="165" height="165" src="../../../assets/img/Userimg.png" class="rounded-circle"/>
  </h5>
  <div class="card-body">
    <H1 class="card-text3">
      Manage Users
    </H1>
  </div>
  <div class="card-footer3 marginbottom">

    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#addUserModal">Add User</button>
    <br><br>
    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#editUserModal">Edit User</button>
    <br><br>
    <div class="row">
      <div class="col-6">
        <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#activateUserModal">Activate User</button>
      </div>
      <div class="col-6">
        <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#deleteUserModal">Delete / Disable User</button>
      </div>
    </div>
    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#managePurchaseApproversModal">Manage Purchase Request Managers</button>
    <br><br>

  </div>
</div>

<!-- Add User -->
<div class="modal fade bd-example-modal-lg" id="addUserModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addUserModalLabel">Add a New User</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body user-modal-body">
        <perfect-scrollbar class="scroll-container" fxFlex="auto" [config]="config" [scrollIndicators]="true">
          <div class="user-form-container">
            <ng-container *ngIf="addUserForm">
              <form [formGroup]="addUserForm">
                <div class="form-row">
                  <div class="form-group col-sm-12 col-md-4 col-lg-4">
                    <label for="addUser_UserName" class="form-label">Username</label>
                    <input class="form-control user-form-control" id="addUser_UserName" placeholder="Username" formControlName="username" required>
                    <ng-container *ngIf="(addUserFormSubmitted && addUserForm.controls.username.invalid) || (addUserForm.dirty && addUserForm.controls.username.touched && addUserForm.controls.username.invalid)">
                      <label class="validation-message">This field is required.</label>
                    </ng-container>
                  </div>
                  <div class="form-group col-sm-12 col-md-4 col-lg-4" formGroupName="roleGroup">
                    <label for="addUser_securityRole" class="form-label">Role</label>
                    <select formControlName="securityRole" class="form-control user-form-control black" id="addUser_securityRole" name="addUser_securityRole" required>
                      <option [ngValue]="null" [disabled]="true">Role</option>
                      <ng-container *ngFor="let securityRole of securityRoles">
                        <option [ngValue]="securityRole" class="black">
                          {{securityRole.Name}}
                        </option>
                      </ng-container>

                    </select>
                    <ng-container *ngIf="(addUserFormSubmitted && addUserForm.controls.roleGroup.get('securityRole')?.invalid) || (addUserForm.dirty && addUserForm.controls.roleGroup.get('securityRole')?.touched && addUserForm.controls.roleGroup.get('securityRole')?.invalid)">
                      <label class="validation-message">This field is required.</label>
                    </ng-container>
                  </div>
                  <div class="form-group col-sm-12 col-md-4 col-lg-4">
                    <label for="addUser_department" class="form-label">Department</label>
                    <select formControlName="department" class="form-control user-form-control black" id="addUser_department" name="addUser_department" required>
                      <option [ngValue]="null" [disabled]="true">Department</option>
                      <ng-container *ngFor="let department of departments">
                        <option [ngValue]="department" class="black">
                          {{department.Name}}
                        </option>
                      </ng-container>

                    </select>
                    <ng-container *ngIf="(addUserFormSubmitted && addUserForm.controls.department.invalid) || (addUserForm.dirty && addUserForm.controls.department.touched && addUserForm.controls.department.invalid)">
                      <label class="validation-message">This field is required.</label>
                    </ng-container>
                  </div>
                </div>
                <ng-container *ngIf="addUserForm.controls.roleGroup.get('securityRole')?.value?.Id !== 3">
                  <div class="form-row">
                    <ng-container *ngIf="addUserForm.controls.roleGroup.get('securityRole')?.value?.Id === 1 || !addUserForm.controls.roleGroup.get('securityRole')?.value">
                      <div class="form-group col-sm-12 col-md-6 col-log-6" >
                        <label for="addUser_points" class="form-label">Starting Points Amount</label>
                        <input class="form-control user-form-control" type="number" min="0" step="1" id="addUser_points" placeholder="0" formControlName="points" value="0">
                        <ng-container *ngIf="(addUserFormSubmitted) || (addUserForm.dirty && addUserForm.controls.points.touched && addUserForm.controls.points.value < 0)">
                          <label class="validation-message">The value must be a whole number and cannot be less than 0.</label>
                        </ng-container>
                      </div>
                    </ng-container>

                    <ng-container *ngIf="addUserForm.controls.roleGroup.get('securityRole')?.value?.Id === 2">
                      <div class="form-group col-sm-12 col-md-6 col-log-6" formGroupName="roleGroup">
                        <label for="addUser_pointsPool" class="form-label">Starting Points Pool Amount (out of {{pointPoolMax}})</label>
                        <input class="form-control user-form-control" id="addUser_pointsPool" type="number" min="0" max="{{pointPoolMax}}" step="1" placeholder="{{pointPoolMax}}" formControlName="pointsPool" value="{{pointPoolMax}}">
                        <ng-container *ngIf="(addUserFormSubmitted) || (addUserForm.dirty && addUserForm.controls.roleGroup.get('pointsPool')?.touched && (addUserForm.controls.roleGroup.get('pointsPool')?.value < 0) || (addUserForm.controls.roleGroup.get('pointsPool')?.value > pointPoolMax))">
                          <label class="validation-message">The value must be a whole number between 0 and {{pointPoolMax}}, inclusive.</label>
                        </ng-container>
                      </div>
                    </ng-container>

                    <div class="form-group col-sm-12 col-md-4 col-lg-4">
                      <label for="addUser_position" class="form-label">Position</label>
                      <input type="text" class="form-control user-form-control black" id="addUser_position" placeholder="Position" formControlName="position" >
                    </div>
                  </div>

                </ng-container>

                <div class="form-row">
                  <div class="form-group col-sm-12 col-md-4 col-lg-4">
                    <label for="addUser_firstName" class="form-label">First Name</label>
                    <input class="form-control user-form-control" id="addUser_firstName" placeholder="First Name" formControlName="firstName">
                    <ng-container *ngIf="(addUserFormSubmitted && addUserForm.controls.firstName.invalid) || (addUserForm.dirty && addUserForm.controls.firstName.touched && addUserForm.controls.firstName.invalid)">
                      <label class="validation-message">This field is required.</label>
                    </ng-container>
                  </div>
                  <div class="form-group col-sm-12 col-md-4 col-lg-4">
                    <label for="addUser_middleName" class="form-label">Middle Name</label>
                    <input class="form-control user-form-control" id="addUser_middleName" placeholder="Middle Name" formControlName="middleName">
                  </div>
                  <div class="form-group col-sm-12 col-md-4 col-lg-4">
                    <label for="addUser_lastName" class="form-label">Last Name</label>
                    <input class="form-control user-form-control" id="addUser_lastName" placeholder="Last Name" formControlName="lastName">
                    <ng-container *ngIf="(addUserFormSubmitted && addUserForm.controls.lastName.invalid) || (addUserForm.dirty && addUserForm.controls.lastName.touched && addUserForm.controls.lastName.invalid)">
                      <label class="validation-message">This field is required.</label>
                    </ng-container>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group col-sm-12 col-md-4 col-lg-4">
                    <label for="addUser_preferredName" class="form-label">Preferred Name</label>
                    <input type="text" class="form-control user-form-control black" id="addUser_preferredName" placeholder="Preferred Name" formControlName="preferredName">
                  </div>
                  <div class="form-group col-sm-12 col-md-4 col-lg-4">
                    <label for="addUser_birthdate" class="form-label">Date of Birth</label>
                    <input type="text" [matDatepicker]="addUser_birthdate"
                           (click)="addUser_birthdate.open()"
                           placeholder="Date of Birth"
                           formControlName="birthdate"
                           class="form-control user-form-control datepicker"
                           id="addUser_birthdate">
                    <mat-datepicker #addUser_birthdate [startView]="'year'"></mat-datepicker>
                    <ng-container *ngIf="(addUserFormSubmitted && addUserForm.controls.birthdate.invalid) || (addUserForm.dirty && addUserForm.controls.birthdate.touched && addUserForm.controls.birthdate.invalid)">
                      <label class="validation-message">This field is required.</label>
                    </ng-container>
                  </div>
                  <div class="form-group col-sm-12 col-md-4 col-lg-4">
                    <label for="addUser_dateOfHire" class="form-label">Date of Hire</label>
                    <input type="text" [matDatepicker]="addUser_dateOfHire"
                           (click)="addUser_dateOfHire.open()"
                           placeholder="Date of Hire"
                           formControlName="dateOfHire"
                           class="form-control user-form-control datepicker"
                           id="addUser_dateOfHire">
                    <mat-datepicker #addUser_dateOfHire [startView]="'month'"></mat-datepicker>
                  </div>
                </div>
                <ng-container *ngIf="addUserForm.controls.birthdate.value && getAge(addUserForm.controls.birthdate.value) < 18">
                  <div class="form-row justify-content-center">
                    <div class="col-sm-12 col-md-12 col-lg-8 text-left">
                      <label class="validation-message">This employee is under 18 years of age. Please make certain you have their parent or legal guardian's permission to create this account!</label>
                    </div>
                  </div>
                </ng-container>

                <div class="form-row">
                  <div class="form-group col-sm-12 col-md-4 col-lg-4">
                    <label for="addUser_email" class="form-label">Email</label>
                    <input type="email" class="form-control user-form-control black" id="addUser_email" placeholder="Email" formControlName="email" >
                    <ng-container *ngIf="(addUserFormSubmitted && addUserForm.controls.email.invalid) || (addUserForm.dirty && addUserForm.controls.email.touched && addUserForm.controls.email.invalid)">
                      <label class="validation-message">This field is required.</label>
                    </ng-container>
                  </div>
                  <div class="form-group col-sm-12 col-md-4 col-lg-4">
                    <label for="addUser_phone" class="form-label">Phone</label>
                    <input class="form-control user-form-control black"
                           placeholder="Phone"
                           formControlName="phone"
                           name="addUser_phone"
                           appPhoneMask
                           type="tel"
                           maxLength="14"
                           id="addUser_phone"
                    >
                    <ng-container *ngIf="(addUserFormSubmitted && addUserForm.controls.phone.invalid) || (addUserForm.dirty && addUserForm.controls.phone.touched && phoneValidationError)">
                      <label class="validation-message">This field is required.</label>
                      <ng-container *ngIf="phoneValidationError">
                        <label class="validation-message">{{phoneValidationError}}</label>
                      </ng-container>

                    </ng-container>
                  </div>
                </div>

              </form>
            </ng-container>


          </div>
        </perfect-scrollbar>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" >Close</button>
        <button type="button" class="btn btn-primary" (click)="onAddUserFormSubmit(addUserForm)">Save changes</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete User -->
<div class="modal fade bd-example-modal-lg deleteUser-modal" id="deleteUserModal" tabindex="-1" role="dialog"
     aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteUserModalLabel">Select a user to delete</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body user-modal-body">
        <form [formGroup]="deleteUserForm">
          <div class="form-row">
            <div class="form-group col-sm-12 col-md-6 col-lg-6 col-xl-6">
              <label for="deleteUser_user" class="form-label">User to Delete</label>
              <select formControlName="user"
                      class="form-control user-form-control"
                      id="deleteUser_user" name="deleteUser_user">
                <option [ngValue]="null" disabled="true">Select a User</option>
                <ng-container *ngFor="let user of users">
                  <option [ngValue]="user">
                    {{user.username}}
                  </option>
                </ng-container>

              </select>
              <ng-container *ngIf="(deleteUserFormSubmitted && deleteUserForm.controls.user.invalid) || (deleteUserForm.dirty && deleteUserForm.controls.user.touched && deleteUserForm.controls.user.invalid)">
                <label class="validation-message">This field is required.</label>
              </ng-container>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" (click)="onDeleteUserFormSubmit(deleteUserForm)">Delete User</button>
        <button type="button" class="btn btn-primary" (click)="onDeactivateUserFormSubmit(deleteUserForm)">Deactivate User</button>
      </div>
    </div>
  </div>
</div>

<!-- Activate User -->
<div class="modal fade bd-example-modal-lg activateUser-modal" id="activateUserModal" tabindex="-1" role="dialog"
     aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="activateUserModalLabel">Select a user to activate</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body user-modal-body">
        <form [formGroup]="activateUserForm">
          <div class="form-row">
            <div class="form-group col-sm-12 col-md-6 col-lg-6 col-xl-6">
              <label for="activateUser_user" class="form-label">User to Activate</label>
              <select formControlName="user"
                      class="form-control user-form-control"
                      id="activateUser_user" name="activateUser_user">
                <option [ngValue]="null" disabled="true">Select a User</option>
                <ng-container *ngFor="let user of deactivatedUsers">
                  <option [ngValue]="user">
                    {{user.username}}
                  </option>
                </ng-container>

              </select>
              <ng-container *ngIf="(activateUserFormSubmitted && activateUserForm.controls.user.invalid) || (activateUserForm.dirty && activateUserForm.controls.user.touched && activateUserForm.controls.user.invalid)">
                <label class="validation-message">This field is required.</label>
              </ng-container>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" (click)="onActivateUserFormSubmit(activateUserForm)">Activate User</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit User -->
<div class="modal fade bd-example-modal-lg editUser-modal" id="editUserModal" tabindex="-1" role="dialog"
     aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editUserModalLabel">Modify a User </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body user-modal-body">
        <perfect-scrollbar class="scroll-container" fxFlex="auto" [config]="config" [scrollIndicators]="true">
          <div class="user-form-container">

            <form [formGroup]="editUserForm">
              <div class="form-row">
                <div class="form-group col-sm-12 col-md-4 col-lg-4">
                  <label for="editUser_user" class="form-label">User to Modify</label>
                  <select formControlName="user"
                          class="form-control user-form-control"
                          id="editUser_user" name="editUser_user">
                    <option [ngValue]="null" disabled="true">Select a User to Modify</option>
                    <ng-container *ngFor="let user of users; trackBy: trackByFunction" >
                      <option [ngValue]="user">
                        {{user.firstName}} {{user.lastName}} ({{user.username}})
                      </option>
                    </ng-container>

                  </select>
                  <ng-container *ngIf="(editUserFormSubmitted && editUserForm.controls.user.invalid) || (editUserForm.dirty && editUserForm.controls.user.touched && editUserForm.controls.user.invalid)">
                    <label class="validation-message">This field is required.</label>
                  </ng-container>
                </div>
                <div class="form-group col-sm-12 col-md-4 col-lg-4" formGroupName="roleGroup">
                  <label for="editUser_securityRole" class="form-label">Role</label>
                  <select formControlName="securityRole" class="form-control user-form-control" id="editUser_securityRole" name="editUser_securityRole" >
                    <option [ngValue]="null" [disabled]="true">Role</option>
                    <ng-container *ngFor="let securityRole of securityRoles">
                      <option [ngValue]="securityRole">
                        {{securityRole.Name}}
                      </option>
                    </ng-container>

                  </select>
                  <ng-container *ngIf="(editUserFormSubmitted && editUserForm.controls.roleGroup.get('securityRole')?.invalid) || (editUserForm.dirty && editUserForm.controls.roleGroup.get('securityRole')?.touched && editUserForm.controls.roleGroup.get('securityRole')?.invalid)">
                    <label class="validation-message">This field is required.</label>
                  </ng-container>
                </div>
                <div class="form-group col-sm-12 col-md-4 col-lg-4">
                  <label for="editUser_department" class="form-label">Department</label>
                  <select formControlName="department" class="form-control user-form-control" id="editUser_department" name="editUser_department">
                    <option [ngValue]="null" [disabled]="true">Department</option>
                    <ng-container *ngFor="let department of departments">
                      <option [ngValue]="department">
                        {{department.Name}}
                      </option>
                    </ng-container>

                  </select>
                  <ng-container *ngIf="(editUserFormSubmitted && editUserForm.controls.roleGroup.get('securityRole')?.invalid) || (editUserForm.dirty && editUserForm.controls.roleGroup.get('securityRole')?.touched && editUserForm.controls.roleGroup.get('securityRole')?.invalid)">
                    <label class="validation-message">This field is required.</label>
                  </ng-container>
                </div>
              </div>

              <ng-container *ngIf="editUserForm.controls.roleGroup.get('securityRole')?.value?.Id !== 3">
                <div class="form-row">
                  <ng-container *ngIf="editUserForm.controls.roleGroup.get('securityRole')?.value?.Id === 1 || !editUserForm.controls.roleGroup.get('securityRole')?.value">
                    <div class="form-group col-sm-12 col-md-6 col-log-6">
                      <label for="editUser_points" class="form-label">Points Amount</label>
                      <input class="form-control user-form-control" type="number" id="editUser_points" min="0" step="1" placeholder="0" formControlName="points" value="0">
                      <ng-container *ngIf="(editUserFormSubmitted) || (editUserForm.dirty && editUserForm.controls.points.touched && editUserForm.controls.points.value < 0)">
                        <label class="validation-message">The value cannot be less than 0.</label>
                      </ng-container>
                    </div>
                  </ng-container>

                  <ng-container *ngIf="editUserForm.controls.roleGroup.get('securityRole')?.value?.Id === 2">
                    <div class="form-group col-sm-12 col-md-6 col-log-6" formGroupName="roleGroup">
                      <label for="editUser_pointsPool" class="form-label">Points Pool Amount (out of {{pointPoolMax}})</label>
                      <input class="form-control user-form-control" type="number" id="editUser_pointsPool" min="0" max="{{pointPoolMax}}" step="1" placeholder="{{pointPoolMax}}" formControlName="pointsPool" value="5000">
                      <ng-container *ngIf="(editUserFormSubmitted) || (editUserForm.dirty && editUserForm.controls.roleGroup.get('pointsPool')?.touched && (editUserForm.controls.roleGroup.get('pointsPool')?.value < 0) || (editUserForm.controls.roleGroup.get('pointsPool')?.value > pointPoolMax))">
                        <label class="validation-message">The value must be a whole number between 0 and {{pointPoolMax}}, inclusive.</label>
                      </ng-container>
                    </div>
                  </ng-container>

                  <div class="form-group col-sm-12 col-md-4 col-lg-4">
                    <label for="editUser_position" class="form-label">Position</label>
                    <input type="text" class="form-control user-form-control black" id="editUser_position" placeholder="Position" formControlName="position" >
                  </div>
                </div>

              </ng-container>

              <div class="form-row">
                <div class="form-group col-sm-12 col-md-4 col-lg-4">
                  <label for="editUser_firstName" class="form-label">First Name</label>
                  <input class="form-control user-form-control" id="editUser_firstName" placeholder="First Name" formControlName="firstName">
                  <ng-container *ngIf="(editUserFormSubmitted && editUserForm.controls.firstName.invalid) || (editUserForm.dirty && editUserForm.controls.firstName.touched && editUserForm.controls.firstName.invalid)">
                    <label class="validation-message">This field is required.</label>
                  </ng-container>
                </div>
                <div class="form-group col-sm-12 col-md-4 col-lg-4">
                  <label for="editUser_middleName" class="form-label">Middle Name</label>
                  <input class="form-control user-form-control" id="editUser_middleName" placeholder="Middle Name" formControlName="middleName">
                </div>
                <div class="form-group col-sm-12 col-md-4 col-lg-4">
                  <label for="editUser_lastName" class="form-label">Last Name</label>
                  <input class="form-control user-form-control" id="editUser_lastName" placeholder="Last Name" formControlName="lastName">
                  <ng-container *ngIf="(editUserFormSubmitted && editUserForm.controls.lastName.invalid) || (editUserForm.dirty && editUserForm.controls.lastName.touched && editUserForm.controls.lastName.invalid)">
                    <label class="validation-message">This field is required.</label>
                  </ng-container>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group col-sm-12 col-md-4 col-lg-4">
                  <label for="editUser_preferredName" class="form-label">Preferred Name</label>
                  <input type="text" class="form-control user-form-control" id="editUser_preferredName" placeholder="Preferred Name" formControlName="preferredName">
                </div>
                <div class="form-group col-sm-12 col-md-4 col-lg-4">
                  <label for="editUser_birthdate" class="form-label">Date of Birth</label>

                  <input type="text" [matDatepicker]="editUser_birthdate" (dateChange)="logDate($event)"
                         (click)="editUser_birthdate.open()"
                         placeholder="Date of Birth"
                         formControlName="birthdate"
                         class="form-control user-form-control datepicker"
                         id="editUser_birthdate">
                  <mat-datepicker #editUser_birthdate [startView]="'year'"></mat-datepicker>
                  <ng-container *ngIf="(editUserFormSubmitted && editUserForm.controls.birthdate.invalid) || (editUserForm.dirty && editUserForm.controls.birthdate.touched && editUserForm.controls.birthdate.invalid)">
                    <label class="validation-message">This field is required.</label>
                  </ng-container>

                </div>
                <div class="form-group col-sm-12 col-md-4 col-lg-4">
                  <label for="editUser_dateOfHire" class="form-label">Date of Hire</label>
                  <input type="text" [matDatepicker]="editUser_dateOfHire"
                         (click)="editUser_dateOfHire.open()"
                         placeholder="Date of Hire"
                         formControlName="dateOfHire"
                         class="form-control user-form-control datepicker"
                         id="editUser_dateOfHire">
                  <mat-datepicker #editUser_dateOfHire [startView]="'month'"></mat-datepicker>
                </div>
              </div>
              <ng-container *ngIf="editUserForm.controls.birthdate.value && getAge(editUserForm.controls.birthdate.value) < 18">
                <div class="form-row justify-content-center">
                  <div class="col-sm-12 col-md-12 col-lg-8 text-left">
                    <label class="validation-message">This employee is under 18 years of age. Please make certain you have their parent or legal guardian's permission to create this account!</label>
                  </div>
                </div>
              </ng-container>


              <div class="form-row">
                <div class="form-group col-sm-12 col-md-4 col-lg-4">
                  <label for="editUser_email" class="form-label">Email</label>
                  <input type="email" class="form-control user-form-control" id="editUser_email" placeholder="Email" formControlName="email">
                  <ng-container *ngIf="(editUserFormSubmitted && editUserForm.controls.email.invalid) || (editUserForm.dirty && editUserForm.controls.email.touched && editUserForm.controls.email.invalid)">
                    <label class="validation-message">This field is required.</label>
                  </ng-container>
                </div>
                <div class="form-group col-sm-12 col-md-4 col-lg-4">
                  <label for="editUser_phone" class="form-label">Phone</label>
                  <input class="form-control user-form-control"
                         placeholder="Phone"
                         formControlName="phone"
                         name="editUser_phone"
                         appPhoneMask
                         type="tel"
                         maxLength="14"
                         [ngClass]="{'invalid-textbox' : editUserForm.dirty && editUserForm.controls.phone.touched && editUserForm.controls.phone.invalid}"
                         id="editUser_phone">


                  <ng-container *ngIf="(editUserFormSubmitted && editUserForm.controls.phone.invalid) || (editUserForm.dirty && editUserForm.controls.phone.touched && phoneValidationError)">
                    <label class="validation-message">This field is required.</label>
                    <ng-container *ngIf="phoneValidationError" >
                      <label class="validation-message">{{phoneValidationError}}</label>

                    </ng-container>
                  </ng-container>
                </div>
              </div>


            </form>

          </div>
        </perfect-scrollbar>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="onEditUserFormClose(editUserForm)">Close</button>
        <button type="button" class="btn btn-primary" (click)="onEditUserFormSubmit(editUserForm)">Save changes</button>
      </div>
    </div>
  </div>
</div>

<!-- Manage Purchase Request Managers -->
<div class="modal fade bd-example-modal-lg" id="managePurchaseApproversModal" tabindex="-1" role="dialog"
     aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="managePurchaseApproversModalLabel">Manage Purchase Request Managers</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body user-modal-body">
        <ng-container *ngIf="purchaseApprovers && purchaseApproverForm">
          <h4 class="text-dark">Current Purchase Request Managers</h4>
          <perfect-scrollbar class="purchase-manager-scroll-container" [config]="config" [scrollIndicators]="true">
          <div>

            <div class="row">
              <ng-container *ngFor="let purchaseApprover of purchaseApprovers">
                <div class="col-3 purchase-manager-item mb-2">
                  <h5 class="text-dark">{{purchaseApprover.user.firstName}} {{purchaseApprover.user.lastName}} ({{purchaseApprover.user.username}})</h5>
                  <h5 class="text-dark">{{purchaseApprover.user.email}}</h5>
                  <h5 class="text-dark">{{purchaseApprover.user.phone}}</h5>
                  <div class="purchase-manager-item-footer text-right">
                    <ng-container *ngIf="purchaseApproverToDelete === purchaseApprover">
                      <span class="text-primary delete-prompt pr-4" (click)="deletePurchaseApprover(purchaseApprover)">Delete?</span>
                    </ng-container>
                    <ng-container *ngIf="purchaseApprovers.length > 1; else onlyOnePurchaseManager">
                      <i class="far fa-trash-alt text-primary trash-icon pr-2" (click)="purchaseApproverDeleteToggle(purchaseApprover)"></i>
                    </ng-container>
                    <ng-template #onlyOnePurchaseManager>
                      <i [matTooltip]="'Unable to delete. There must exist at least one Purchase Request Manager.'"
                         matTooltipPosition="above" class="far fa-trash-alt text-muted trash-icon pr-2"></i>
                    </ng-template>


                  </div>
                </div>

              </ng-container>
            </div>

          </div>
          </perfect-scrollbar>
          <mat-divider></mat-divider>

          <form [formGroup]="purchaseApproverForm">
            <div class="form-row">
              <div class="form-group col-sm-12 col-md-5 col-lg-5 col-xl-5" formGroupName="group">
                <label for="purchaseApprover_user" class="form-label">Add a new Purchase Request Manager</label>
                <select formControlName="purchaseApprover"
                        class="form-control user-form-control"
                        id="purchaseApprover_user" name="purchaseApprover_user">
                  <option [ngValue]="null" disabled="true">Select a User</option>
                  <ng-container *ngFor="let adminUser of adminUsers">
                    <option [ngValue]="adminUser">
                      {{adminUser.firstName}} {{adminUser.lastName}} ({{adminUser.username}})
                    </option>
                  </ng-container>

                </select>
                <ng-container *ngIf="(newPurchaseApproverFormSubmitted && purchaseApproverForm.controls.group.get('purchaseApprover').invalid) || (purchaseApproverForm.dirty && purchaseApproverForm.controls.group.get('purchaseApprover').touched && purchaseApproverForm.controls.group.get('purchaseApprover').invalid)">
                  <label class="validation-message">This field is required.</label>
                </ng-container>
                <ng-container *ngIf="purchaseApproverForm.controls.group.getError('isPurchaseManager')">
                  <label class="validation-message">This user account is already a Purchase Request Manager.</label>
                </ng-container>
              </div>
              <div class="form-group col-7">
                <label class="form-label">New Purchase Requests will appear as notifications within the app. Select any additional new Purchase Requests notification methods.</label>
                <div class="row">
                  <div class="col-5">
                    <div class="row">
                      <div class="form-check form-check-inline">
                        <ng-container *ngIf="this.phoneConfirmed; else phoneUnconfirmed">
                          <label class="form-check-label text-dark">
                            <input class="form-check-input" type="checkbox" id="purchaseApprover_phoneNotifications" formControlName="phoneNotifications">Text
                            <span class="form-check-sign"></span>
                          </label>
                        </ng-container>
                        <ng-template #phoneUnconfirmed>
                          <label class="form-check-label text-dark">
                            <input class="form-check-input" type="checkbox" formControlName="phoneNotifications" [value]="false" disabled><span class="font-disabled text-black-50 pr-2">Text</span>
                            <ng-container *ngIf="this.currentUser?.userId === purchaseApproverForm.controls.group.get('purchaseApprover').value?.userId">
                              <a href="javascript:void(0)">Confirm?</a>
                            </ng-container>
                            <span class="form-check-sign"></span>
                          </label>
                        </ng-template>

                      </div>
                    </div>
                    <div class="row">
                      <ng-container *ngIf="!this.phoneConfirmed">
                        <span class="pr-2">Phone number is not confirmed</span>
                      </ng-container>
                    </div>
                  </div>
                  <div class="col-5">
                    <div class="row">
                      <div class="form-check form-check-inline">
                        <ng-container *ngIf="this.emailConfirmed; else emailUnconfirmed">
                          <label class="form-check-label text-dark">
                            <input class="form-check-input" type="checkbox" id="purchaseApprover_emailNotifications" formControlName="emailNotifications">Email
                            <span class="form-check-sign"></span>
                          </label>
                        </ng-container>
                        <ng-template #emailUnconfirmed>
                          <label class="form-check-label text-dark">
                            <input class="form-check-input" type="checkbox" formControlName="emailNotifications" [value]="false" disabled><span class="font-disabled text-black-50 pr-2">Email</span>
                            <ng-container *ngIf="this.currentUser?.userId === purchaseApproverForm.controls.group.get('purchaseApprover').value?.userId">
                              <a href="javascript:void(0)">Confirm?</a>
                            </ng-container>
                            <span class="form-check-sign"></span>
                          </label>
                        </ng-template>

                      </div>
                    </div>
                    <div class="row">
                      <ng-container *ngIf="!this.emailConfirmed">
                        <span class="pr-2">Email is not confirmed</span>

                      </ng-container>
                    </div>

                  </div>
                </div>


              </div>
            </div>
          </form>
        </ng-container>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" (click)="onNewPurchaseApproverFormSubmit(purchaseApproverForm)">Add Purchase Request Manager</button>
      </div>
    </div>
  </div>
</div>
