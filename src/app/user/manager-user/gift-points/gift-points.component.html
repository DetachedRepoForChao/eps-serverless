<div class="card">
  <div class="card card-coin card-plain">
    <ng-container *ngIf="!isCardLoading && currentUser; else cardLoading">
      <div class="card-body">
        <div class="col-lg-12 col-md-12 col-sm-12">
          <h4 class="text-uppercase">Award Pineapple Points üçç</h4>
          <div class="container">
            <div class="row">
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_happy" (click)="toggleCoreValueButtonFilter('happy')">HAPPY</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_fun" (click)="toggleCoreValueButtonFilter('fun')">FUN</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_genuine" (click)="toggleCoreValueButtonFilter('genuine')">GENUINE</button>
              </div>
            </div>
            <div class="row">
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_caring" (click)="toggleCoreValueButtonFilter('caring')">CARING</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_respect" (click)="toggleCoreValueButtonFilter('respect')">RESPECT</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_honest" (click)="toggleCoreValueButtonFilter('honest')">HONEST</button>
              </div>
            </div>
            <ng-container *ngIf="appliedFilters.length > 0; else noFilters">
              <div class="row">
                <div class="col-1">
                  <div>Filters:</div>
                </div>
                <div class="col-8">
                  <ng-container *ngFor="let filter of appliedFilters">
                    <div class="col-2 filter-col">
                      <span class="filter-item" (click)="toggleCoreValueButtonFilter(filter)">
                        <i class="fas fa-times" ></i> {{filter}}
                      </span>
                    </div>
                  </ng-container>

                </div>
              </div>

            </ng-container>
            <ng-template #noFilters>
              <div class="row">
                <div class="col-1">
                  <div>Filters:</div>
                </div>
                <div class="col-8">
                  <div>None</div>
                </div>
              </div>

            </ng-template>
          </div>

          <!------- Search form -------->
          <div class="row heighted">
            <div class="col-md-4">
              <form class="form py-4">

                <input class="form-control form-rounded w-100 border-neutral" type="text"
                       placeholder="Search Point Items" [(ngModel)]="term2" [ngModelOptions]="{standalone: true}" />
              </form>
            </div>
            <div class="col-md-5 fluid">
              <form class="form py-4">

                <input class="form-control form-rounded w-100 border-neutral" type="text" placeholder="Search Employee"
                       [(ngModel)]="term" [ngModelOptions]="{standalone: true}" />
              </form>
            </div>

            <div class="col-md-3 search">

            </div>

          </div>

          <div>
            <div class="row">
              <div class="container" [class.show]="show">
                <div class="row">
                  <div class="col-md-4">
                    <div class="container text-center">
                      <form #giftPointsForm="ngForm" class="form text-left">
                        <ng-container *ngIf="appliedFilters.length === 0; else filteredList">
                          <div class="selection" >
                            <div class="form-check form-check-radio" *ngFor="let pointItem of (pointItems | pointItem:term2)">
                              <label class="form-check-label form-check-label-color" >
                                <input class="form-check-input" type="radio" name="selectedPointItem" [checked]="(pointItem.name === selectedPointItem?.name) ? true : false"
                                       (click)="selectPointItem(pointItem)">
                                {{(pointItem.amount + ' pts - ' + pointItem.name) | pointItem}}
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                          </div>
                        </ng-container>

                        <ng-template #filteredList class="selection">
                          <ng-container *ngIf="filteredPointItemList.length > 0; else noFilteredMatches">
                            <div >
                              <div class="form-check form-check-radio" *ngFor="let pointItem of (filteredPointItemList | pointItem:term2)">
                                <label class="form-check-label form-check-label-color" >
                                  <input class="form-check-input" type="radio" name="selectedPointItem" [checked]="(pointItem.name === selectedPointItem?.name) ? true : false"
                                         (click)="selectPointItem(pointItem)">
                                  {{(pointItem.amount + ' pts - ' + pointItem.name) | pointItem}}
                                  <span class="form-check-sign"></span>
                                </label>
                              </div>
                            </div>
                          </ng-container>

                          <ng-template #noFilteredMatches>
                            <div class="text-center">
                              <label class="form-check-label form-check-label-color">
                                <span class="form-check-sign">Nothing matching these filters</span>
                              </label>
                            </div>
                          </ng-template>
                        </ng-template>
                        <div class="gift-points-container text-center">
                          <button type="button" class="btn-lg btn-info btn-round"
                                  (click)="pointItemOnSubmit(giftPointsForm, currentUser)">Award Points</button>
                        </div>
                      </form>
                    </div>
                  </div>
                  <div class="col-lg-8 col-md-8 col-sm-8">
                    <div class="row">
                      <ng-container *ngFor="let user of employees | fresh:term; let i = index" class="">
                        <ng-container *ngIf="i <= showLimit">
                          <div class="single-user mx-2 px-1">
                            <img src="{{user.avatarResolvedUrl}}" class="img-row user-selection" [ngClass]="{selected: (selection.isSelected(user))}"
                                 title="{{user['firstName'] + ' ' + user['lastName']}}" (click)="onAvatarClick($event, user)" />
                            <div class="row info-plate-row">
                              <div class="col-12 info-plate-color text-right">
                                <div class="row">
                                  <div class="col-12 pl-0">
                                    <h5 class="text-primary py-0 my-0">{{user.firstName + " " + user.lastName | fresh}}</h5>
                                  </div>
                                  <div class="col-12">
                                    <h5 class="py-0 my-0">{{user.points}} üçç</h5>
                                  </div>
                                  <div class="col-12">
                                    <h5 class="py-0 my-0">{{user.department.Name}}</h5>
                                  </div>



                                </div>

                              </div>
<!--                              <div class="col-12 text-right">

                              </div>
                              <div class="col-12 text-right">

                              </div>-->
                            </div>

                          </div>
                        </ng-container>

                      </ng-container>
                    </div>
                  </div>

                </div>
                <div class="row">
                  <div class="col-md-4"></div>

                  <div class="col-md-4 text-center">
                    <ng-container *ngIf="!showFlag; else buttonViewLess">
                      <button class="btn btn-success text-center" (click)="showMore()">View More</button>
                    </ng-container>
                    <ng-template #buttonViewLess>
                      <button class="btn btn-success text-center" (click)="showLess()">View Less</button>
                    </ng-template>
                  </div>

                  <div class="col-md-4"></div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </ng-container>

  </div>
</div>

<ng-template #cardLoading>
  <div class="card-body">
    <ngx-spinner name="gift-points-spinner" [fullScreen]="false" bdColor="rgba(51,51,51,0.8)" size="medium"
                 color="#fff" type="pacman">
      <p class="loading">Loading...</p>
    </ngx-spinner>
  </div>
</ng-template>

<!-- Placeholder for loading avatar -->
<ng-template #avatarLoading>
  <div>
    <img src="https://placeholder.pics/svg/100x100/DEDEDE/555555/%20" alt="Loading..." class="img-row">
  </div>
</ng-template>
