<div class="card">
  <div class="card card-coin card-plain">
    <ng-container *ngIf="!isCardLoading && currentUser; else cardLoading">
      <div class="card-body">
        <div class="col-lg-12 col-md-12 col-sm-12">
          <h4 class="text-uppercase">Award Pineapple Points üçç</h4>
          <div class="container">
            <div class="row">
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_happy" (click)="toggleCoreValueButtonFilter('happy')">HAPPY</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_fun" (click)="toggleCoreValueButtonFilter('fun')">FUN</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_genuine" (click)="toggleCoreValueButtonFilter('genuine')">GENUINE</button>
              </div>
            </div>
            <div class="row">
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_caring" (click)="toggleCoreValueButtonFilter('caring')">CARING</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_respect" (click)="toggleCoreValueButtonFilter('respect')">RESPECT</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_honest" (click)="toggleCoreValueButtonFilter('honest')">HONEST</button>
              </div>
            </div>
            <ng-container *ngIf="appliedFilters.length > 0; else noFilters">
              <div class="row">
                <div class="col-1">
                  <div>Filters:</div>
                </div>
                <div class="col-8">
                  <ng-container *ngFor="let filter of appliedFilters">
                    <div class="col-2 filter-col">
                      <span class="filter-item" (click)="toggleCoreValueButtonFilter(filter)">
                        <i class="fas fa-times" ></i> {{filter}}
                      </span>
                    </div>
                  </ng-container>

                </div>
              </div>

            </ng-container>
            <ng-template #noFilters>
              <div class="row">
                <div class="col-1">
                  <div>Filters:</div>
                </div>
                <div class="col-8">
                  <div>None</div>
                </div>
              </div>

            </ng-template>
          </div>

          <!------- Search form -------->
          <div class="row heighted">
            <div class="col-md-4">
              <div class="col-12">
                <form class="form py-4">

                  <input class="form-control form-rounded w-100 border-neutral" type="text"
                         placeholder="Search Point Items" [(ngModel)]="term2" [ngModelOptions]="{standalone: true}" />
                </form>
              </div>

            </div>
            <div class="col-md-5 fluid">
              <div class="col-12">
                <form class="form py-4">

                  <input class="form-control form-rounded w-100 border-neutral" type="text" placeholder="Search Employee"
                         [(ngModel)]="term" [ngModelOptions]="{standalone: true}" />
                </form>
              </div>

            </div>

            <div class="col-md-3 search">

            </div>

          </div>

          <div>
            <div class="row">
              <div class="container" [class.show]="show">
                <div class="row">
                  <div class="col-md-4">
                    <div class="container text-center">
                      <div><a href="javascript:void(0)" data-toggle="modal" data-target="#addPointItemModal">Create a custom üçç award</a></div>
                      <form #giftPointsForm="ngForm" class="form text-left">
                        <ng-container *ngIf="appliedFilters.length === 0; else filteredList">
                          <div class="selection" >
                            <div class="form-check form-check-radio" *ngFor="let pointItem of (pointItems | pointItem:term2)">
                              <label class="form-check-label form-check-label-color" >
                                <input class="form-check-input" type="radio" name="selectedPointItem" [checked]="(pointItem.name === selectedPointItem?.name) ? true : false"
                                       (click)="selectPointItem(pointItem)">
                                {{(pointItem.amount + ' pts - ' + pointItem.name) | pointItem}}
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                          </div>
                        </ng-container>

                        <ng-template #filteredList class="selection">
                          <ng-container *ngIf="filteredPointItemList.length > 0; else noFilteredMatches">
                            <div >
                              <div class="form-check form-check-radio" *ngFor="let pointItem of (filteredPointItemList | pointItem:term2)">
                                <label class="form-check-label form-check-label-color" >
                                  <input class="form-check-input" type="radio" name="selectedPointItem" [checked]="(pointItem.name === selectedPointItem?.name) ? true : false"
                                         (click)="selectPointItem(pointItem)">
                                  {{(pointItem.amount + ' pts - ' + pointItem.name) | pointItem}}
                                  <span class="form-check-sign"></span>
                                </label>
                              </div>
                            </div>
                          </ng-container>

                          <ng-template #noFilteredMatches>
                            <div class="text-center">
                              <label class="form-check-label form-check-label-color">
                                <span class="form-check-sign">Nothing matching these filters</span>
                              </label>
                            </div>
                          </ng-template>
                        </ng-template>
                        <div class="gift-points-container text-center">
                          <button type="button" class="btn btn-primary" (click)="pointItemOnSubmit(giftPointsForm, currentUser)">Award üçç</button>
                        </div>
                      </form>
                    </div>
                  </div>
                  <div class="col-lg-8 col-md-8 col-sm-8">
                    <div class="row">
                      <ng-container *ngFor="let user of employees | fresh:term; let i = index" class="">
                        <ng-container *ngIf="i <= showLimit">
                          <div class="single-user mx-2 px-1">
                            <img src="{{user.avatarResolvedUrl}}" class="img-row user-selection" [ngClass]="{selected: (selection.isSelected(user))}"
                                 title="{{user['firstName'] + ' ' + user['lastName']}}" (click)="onAvatarClick($event, user)" />
                            <div class="row info-plate-row">
                              <div class="col-12 info-plate-color text-right">
                                <div class="row">
                                  <div class="col-12 pl-0">
                                    <h5 class="text-primary py-0 my-0">{{user.firstName + " " + user.lastName | fresh}}</h5>
                                  </div>
                                  <div class="col-12">
                                    <h5 class="py-0 my-0">{{user.points}} üçç</h5>
                                  </div>
                                  <div class="col-12">
                                    <h5 class="py-0 my-0">{{user.department.Name}}</h5>
                                  </div>



                                </div>

                              </div>
<!--                              <div class="col-12 text-right">

                              </div>
                              <div class="col-12 text-right">

                              </div>-->
                            </div>

                          </div>
                        </ng-container>

                      </ng-container>
                    </div>
                  </div>

                </div>
                <div class="row">
                  <div class="col-md-4"></div>

                  <div class="col-md-4 text-center">
                    <ng-container *ngIf="!showFlag; else buttonViewLess">
                      <button class="btn btn-success text-center" (click)="showMore()">View More</button>
                    </ng-container>
                    <ng-template #buttonViewLess>
                      <button class="btn btn-success text-center" (click)="showLess()">View Less</button>
                    </ng-template>
                  </div>

                  <div class="col-md-4"></div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </ng-container>

  </div>
</div>

<!-- Add Point Item -->
<div class="modal fade bd-example-modal-lg" id="addPointItemModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addPointItemModalLabel">Add a New üçç Award</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body pointItem-modal-body">
        <perfect-scrollbar class="scroll-container" fxFlex="auto" [config]="config" [scrollIndicators]="false">
          <div class="pointItem-form-container">
            <form [formGroup]="addPointItemForm">
              <div class="form-row">
                <div class="form-group col-sm-12 col-md-6 col-lg-6 col-xl-6 text-dark text-left" >
                  <label for="addPointItem_name">üçç Award Name</label>
                  <input type="text" class="form-control pointItem-form-control text-dark text-left" formControlName="name"  id="addPointItem_name" placeholder="Point Item Name">
                  <div *ngIf="(addPointItemFormSubmitted && addPointItemForm.controls.name.invalid) || (addPointItemForm.dirty && addPointItemForm.controls.name.touched && addPointItemForm.controls.name.invalid)">
                    <label class="validation-message">This field is required.</label>
                  </div>
                </div>
                <div class="form-group col-sm-12 col-md-6 col-lg-6 col-xl-6 text-dark">
                  <label for="addPointItem_amount">üçç Amount</label>
                  <input type="number" min="1" class="form-control pointItem-form-control text-dark text-left" formControlName="amount" id="addPointItem_amount" placeholder="Point Amount">
                  <div *ngIf="(addPointItemFormSubmitted && addPointItemForm.controls.amount.invalid) || (addPointItemForm.dirty && addPointItemForm.controls.amount.touched && addPointItemForm.controls.amount.invalid)">
                    <label class="validation-message">This field is required.</label>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-12 text-left text-dark">
                  <label for="addPointItem_description">Description</label>
                  <input type="text" class="form-control pointItem-form-control text-dark text-left" formControlName="description" id="addPointItem_description" placeholder="Description">
                </div>
              </div>
              <div class="form-row">
                <div class="col-12 text-dark">
                  <label>Core Values</label>
                  <div class="form-group" formGroupName="coreValuesGroup">
                    <div class="form-check form-check-inline">
                      <label class="form-check-label text-dark">
                        <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_happy" formControlName="coreValue_happy">Happy
                        <span class="form-check-sign"></span>
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <label class="form-check-label text-dark">
                        <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_fun" formControlName="coreValue_fun">Fun
                        <span class="form-check-sign"></span>
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <label class="form-check-label text-dark">
                        <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_genuine" formControlName="coreValue_genuine">Genuine
                        <span class="form-check-sign"></span>
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <label class="form-check-label text-dark">
                        <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_caring" formControlName="coreValue_caring">Caring
                        <span class="form-check-sign"></span>
                      </label>
                    </div>

                    <div class="form-check form-check-inline">
                      <label class="form-check-label text-dark">
                        <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_respect" formControlName="coreValue_respect">Respect
                        <span class="form-check-sign"></span>
                      </label>
                    </div>
                    <div class="form-check form-check-inline">
                      <label class="form-check-label text-dark">
                        <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_honest" formControlName="coreValue_honest">Honest
                        <span class="form-check-sign"></span>
                      </label>
                    </div>
                    <div *ngIf="(addPointItemFormSubmitted && addPointItemForm.controls['coreValuesGroup'].errors?.requireCheckboxesToBeChecked) || (addPointItemForm.dirty && addPointItemForm.controls['coreValuesGroup'].errors && addPointItemForm.controls['coreValuesGroup'].errors?.requireCheckboxesToBeChecked)">
                      <label class="validation-message">Please select at least one Core Value.</label>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </perfect-scrollbar>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" (click)="onAddPointItemFormSubmit(addPointItemForm)">Save Changes</button>
      </div>
    </div>
  </div>
</div>


<ng-template #cardLoading>
  <div class="card-body">
    <ngx-spinner name="gift-points-spinner" [fullScreen]="false" bdColor="rgba(51,51,51,0.8)" size="medium"
                 color="#fff" type="pacman">
      <p class="loading">Loading...</p>
    </ngx-spinner>
  </div>
</ng-template>

<!-- Placeholder for loading avatar -->
<ng-template #avatarLoading>
  <div>
    <img src="https://placeholder.pics/svg/100x100/DEDEDE/555555/%20" alt="Loading..." class="img-row">
  </div>
</ng-template>
