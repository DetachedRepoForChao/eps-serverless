<div class="card">
  <div class="card card-coin card-plain">
    <ng-container *ngIf="!isCardLoading && currentUser && employees && pointItems; else cardLoading">
      <div class="card-body">
        <div class="col-lg-12 col-md-12 col-sm-12">
          <h4 class="text-uppercase">Award Pineapple Points üçç</h4>
          <div class="container">
            <div class="row">
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_happy" (click)="toggleCoreValueButtonFilter('happy')">HAPPY</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_fun" (click)="toggleCoreValueButtonFilter('fun')">FUN</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_genuine" (click)="toggleCoreValueButtonFilter('genuine')">GENUINE</button>
              </div>
            </div>
            <div class="row">
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_caring" (click)="toggleCoreValueButtonFilter('caring')">CARING</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_respect" (click)="toggleCoreValueButtonFilter('respect')">RESPECT</button>
              </div>
              <div class="col-sm">
                <button type="button" class="btn btn-primary btn-sm btn-block" data-toggle="button" aria-pressed="false"
                        id="button_honest" (click)="toggleCoreValueButtonFilter('honest')">HONEST</button>
              </div>
            </div>
            <ng-container *ngIf="appliedFilters.length > 0; else noFilters">
              <div class="row">
                <div class="col-1">
                  <div>Filters:</div>
                </div>
                <div class="col-8">
                  <ng-container *ngFor="let filter of appliedFilters">
                    <div class="col-2 filter-col">
                      <span class="filter-item" (click)="toggleCoreValueButtonFilter(filter)">
                        <i class="fas fa-times" ></i> {{filter}}
                      </span>
                    </div>
                  </ng-container>

                </div>
              </div>

            </ng-container>
            <ng-template #noFilters>
              <div class="row">
                <div class="col-1">
                  <div>Filters:</div>
                </div>
                <div class="col-8">
                  <div>None</div>
                </div>
              </div>

            </ng-template>
          </div>

          <!------- Point Item Search form -------->
          <div class="row height-80">
            <div class="col-md-4">
              <div class="col-12">
                <ng-container *ngIf="pointSearchForm">
                  <form [formGroup]="pointSearchForm" class="form text-center">
                    <label class="form-label">Search üçç Awards</label>
                    <input class="form-control form-rounded w-100 border-neutral" type="text"
                           placeholder="Search" [(ngModel)]="term2" [ngModelOptions]="{standalone: true}" />
                  </form>
                </ng-container>

              </div>

            </div>
            <!------- Employee Search form -------->
            <div class="col-md-3 fluid">
              <div class="col-12">
                <ng-container *ngIf="employeeSearchForm">
                  <form [formGroup]="employeeSearchForm" class="form text-center">
                    <label class="form-label">Search Employees</label>
                    <input class="form-control form-rounded w-100 border-neutral" type="text" placeholder="Search"
                           [(ngModel)]="term" [ngModelOptions]="{standalone: true}" />
                  </form>
                </ng-container>

              </div>

            </div>

            <div class="col-sm-12 col-md-2 col-lg-2 text-center">
              <form [formGroup]="departmentSelectionForm">
                <label class="form-label">Select Entire Department</label>
                <select formControlName="departmentSelection" class="form-control department-form-control text-left" id="departmentSelection" name="departmentSelection" >
                  <option [ngValue]="null" [disabled]="true">Department</option>
                  <ng-container *ngFor="let department of departments">
                    <option [ngValue]="department">
                      {{department.Name}}
                    </option>
                  </ng-container>

                </select>
              </form>

<!--              <ng-container *ngIf="(addUserFormSubmitted && addUserForm.controls.department.invalid) || (addUserForm.dirty && addUserForm.controls.department.touched && addUserForm.controls.department.invalid)">
                <label class="validation-message">This field is required.</label>
              </ng-container>-->
            </div>
            <div class="col-sm-12 col-md-2 col-lg-2 pb-3 text-center">
              <label class="form-label mb-0">Select All Employees</label>
              <button type="button" class="btn btn-primary" (click)="selectAll()">All Employees</button>

            </div>

          </div>

          <div>
            <div class="row">
              <div class="col-md-4 text-center">
                <ng-container *ngIf="currentUser.awardManager">
                  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#managePointItemModal">Manage üçç Awards</button>
                </ng-container>
              </div>
              <div class="col-4 my-auto">
                <ng-container *ngIf="employees.length >= (showLimit + 1); else noMore" >
                  <span>Displaying {{(showLimit + 1)}} out of {{employees.length}} employees</span>
                </ng-container>
                <ng-template #noMore>
                  <span>Displaying all {{employees.length}} employees</span>
                </ng-template>
                <ng-container *ngIf="!selection.isEmpty(); else zeroSelected">
                  <span class="pl-2">({{selection.selected.length}} selected)</span>
                </ng-container>
                <ng-template #zeroSelected>
                  <span class="pl-2">(0 selected)</span>
                </ng-template>
              </div>
              <div class="col-2 text-center">
                <button type="button" class="btn btn-warning" (click)="clearSelection()">Clear Selection</button>
              </div>

            </div>
            <div class="row">
              <div class="container" [class.show]="show">
                <div class="row">
                  <div class="col-md-4">
                    <div class="container text-center ">

                      <form #giftPointsForm="ngForm" class="form text-left ">
                        <div class="">
                          <perfect-scrollbar id="point-items-scroll" class="point-item-scroll-container" [config]="config" [scrollIndicators]="true">
                            <ng-container *ngIf="appliedFilters.length === 0; else filteredList">
                              <div class="selection pr-3" >
                                <div class="form-check form-check-radio" *ngFor="let pointItem of (pointItems | pointItem:term2)">
                                  <label class="form-check-label form-check-label-color" >
                                    <input class="form-check-input" type="radio" name="selectedPointItem" [checked]="(pointItem.name === selectedPointItem?.name) ? true : false"
                                           (click)="selectPointItem(pointItem)">
                                    {{(pointItem.amount + ' üçç - ' + pointItem.name) | pointItem}}
                                    <span class="form-check-sign"></span>
                                  </label>
                                </div>
                              </div>
                            </ng-container>

                            <ng-template #filteredList class="selection">
                              <ng-container *ngIf="filteredPointItemList.length > 0; else noFilteredMatches">
                                <div >
                                  <div class="form-check form-check-radio" *ngFor="let pointItem of (filteredPointItemList | pointItem:term2)">
                                    <label class="form-check-label form-check-label-color" >
                                      <input class="form-check-input" type="radio" name="selectedPointItem" [checked]="(pointItem.name === selectedPointItem?.name) ? true : false"
                                             (click)="selectPointItem(pointItem)">
                                      {{(pointItem.amount + ' üçç - ' + pointItem.name) | pointItem}}
                                      <span class="form-check-sign"></span>
                                    </label>
                                  </div>
                                </div>
                              </ng-container>

                              <ng-template #noFilteredMatches>
                                <div class="text-center">
                                  <label class="form-check-label form-check-label-color">
                                    <span class="form-check-sign">Nothing matching these filters</span>
                                  </label>
                                </div>
                              </ng-template>
                            </ng-template>
                          </perfect-scrollbar>
                        </div>


                        <div class="gift-points-container text-center">
                          <button type="button" class="btn btn-primary" (click)="openDialog(currentUser, selectedPointItem, selection.selected, selectedDepartment, selectedAll)">Award üçç</button>

                        </div>
                      </form>
                    </div>
                  </div>
                  <div class="col-lg-8 col-md-8 col-sm-8">
                    <div class="row">
                      <ng-container *ngFor="let user of employees | fresh:term; let i = index" class="">
                        <ng-container *ngIf="i <= showLimit">
                          <div class="single-user mx-2 px-1">
                            <img src="{{user.avatarResolvedUrl}}" class="img-row user-selection" [ngClass]="{selected: selection.isSelected(user)}"
                                 title="{{user['firstName'] + ' ' + user['lastName']}}" (click)="onAvatarClick($event, user)" />
                            <div class="row info-plate-row">
                              <div class="col-12 info-plate text-right" [ngClass]="{'info-plate-selected': selection.isSelected(user)}">
                                <div class="row">
                                  <div class="col-12 pl-0">
                                    <h5 class="text-primary py-0 my-0" [ngClass]="{'name-selected': selection.isSelected(user)}">{{user.firstName + " " + user.lastName | fresh}}</h5>
                                  </div>
                                  <div class="col-12">
                                    <h5 class="py-0 my-0">{{user.points}} üçç</h5>
                                  </div>
                                  <div class="col-12">
                                    <h5 class="py-0 my-0">{{user.department.Name}}</h5>
                                  </div>



                                </div>

                              </div>
<!--                              <div class="col-12 text-right">

                              </div>
                              <div class="col-12 text-right">

                              </div>-->
                            </div>

                          </div>
                        </ng-container>

                      </ng-container>
                    </div>
                  </div>

                </div>
                <div class="row">
                  <div class="col-md-4"></div>

                  <div class="col-md-4 text-center">
                    <ng-container *ngIf="!showFlag; else buttonViewLess">
                      <button class="btn btn-success text-center" (click)="showMore()">View More</button>
                    </ng-container>
                    <ng-template #buttonViewLess>
                      <button class="btn btn-success text-center" (click)="showLess()">View Less</button>
                    </ng-template>
                  </div>

                  <div class="col-md-4"></div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </ng-container>

  </div>
</div>

<ng-container *ngIf="currentUser && currentUser.awardManager === true && pointItems">

  <!-- Add Point Item -->
  <div class="modal fade bd-example-modal-lg" id="managePointItemModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="managePointItemModalLabel">Manage üçç Awards</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body pointItem-modal-body">
          <div class="row justify-content-start mb-2">
            <div class="col-auto text-center">
              <span (click)="onManagePointItemTabItemClick('addPointItem')" class="tab-item text-" id="managePointItemTab_addPointItem" [ngClass]="{'tab-toggled': currentManagePointItemView === 'addPointItem'}">Add Award</span>
            </div>
            <div class="col-auto text-center">
              <span (click)="onManagePointItemTabItemClick('editPointItem')" class="tab-item" id="managePointItemTab_editPointItem" [ngClass]="{'tab-toggled': currentManagePointItemView === 'editPointItem'}">Edit Award</span>
            </div>
            <div class="col-auto text-center">
              <span (click)="onManagePointItemTabItemClick('deletePointItem')" class="tab-item" id="managePointItemTab_deletePointItem" [ngClass]="{'tab-toggled': currentManagePointItemView === 'deletePointItem'}">Delete Award</span>
            </div>
          </div>

          <div class="row">
            <div class="col-12">
              <ng-container *ngIf="currentManagePointItemView === 'addPointItem'">
                <perfect-scrollbar class="scroll-container" fxFlex="auto" [config]="config" [scrollIndicators]="false">
                  <div class="pointItem-form-container">
                    <form [formGroup]="addPointItemForm">
                      <div class="form-row">
                        <div class="form-group col-sm-12 col-md-6 col-lg-6 col-xl-6 text-dark text-left" >
                          <label for="addPointItem_name">üçç Award Name</label>
                          <input type="text" class="form-control pointItem-form-control text-dark text-left" formControlName="name"  id="addPointItem_name" placeholder="Point Item Name">
                          <ng-container *ngIf="(addPointItemFormSubmitted && addPointItemForm.controls.name.invalid) || (addPointItemForm.dirty && addPointItemForm.controls.name.touched && addPointItemForm.controls.name.invalid)">
                            <label class="validation-message">This field is required.</label>
                          </ng-container>
                        </div>
                        <div class="form-group col-sm-12 col-md-6 col-lg-6 col-xl-6 text-dark">
                          <label for="addPointItem_amount">üçç Amount</label>
                          <input type="number" min="1" class="form-control pointItem-form-control text-dark text-left" formControlName="amount" id="addPointItem_amount" placeholder="Point Amount">
                          <ng-container *ngIf="(addPointItemFormSubmitted && addPointItemForm.controls.amount.invalid) || (addPointItemForm.dirty && addPointItemForm.controls.amount.touched && addPointItemForm.controls.amount.invalid)">
                            <label class="validation-message">This field is required.</label>
                          </ng-container>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-12 text-left text-dark">
                          <label for="addPointItem_description">Description</label>
                          <input type="text" class="form-control pointItem-form-control text-dark text-left" formControlName="description" id="addPointItem_description" placeholder="Description">
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="col-12 text-dark text-left">
                          <label>Core Values</label>
                          <div class="form-group" formGroupName="coreValuesGroup">
                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_happy" formControlName="coreValue_happy">Happy
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_fun" formControlName="coreValue_fun">Fun
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_genuine" formControlName="coreValue_genuine">Genuine
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_caring" formControlName="coreValue_caring">Caring
                                <span class="form-check-sign"></span>
                              </label>
                            </div>

                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_respect" formControlName="coreValue_respect">Respect
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="addPointItem_checkbox_honest" formControlName="coreValue_honest">Honest
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                            <ng-container *ngIf="(addPointItemFormSubmitted && addPointItemForm.controls['coreValuesGroup'].errors?.requireCheckboxesToBeChecked) || (addPointItemForm.dirty && addPointItemForm.controls['coreValuesGroup'].errors && addPointItemForm.controls['coreValuesGroup'].errors?.requireCheckboxesToBeChecked)">
                              <label class="validation-message">Please select at least one Core Value.</label>
                            </ng-container>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </perfect-scrollbar>
              </ng-container>

              <ng-container *ngIf="currentManagePointItemView === 'editPointItem'">

                <!-- Edit Point Item -->
                <perfect-scrollbar class="scroll-container" fxFlex="auto" [config]="config" [scrollIndicators]="false">
                  <div class="pointItem-form-container">
                    <form [formGroup]="editPointItemForm">
                      <div class="form-row">
                        <div class="form-group col-12 text-dark text-left" >
                          <label for="editPointItem_pointItem" class="form-label">üçç Award to Modify</label>
                          <select formControlName="pointItem"
                                  class="form-control pointItem-form-control text-dark"
                                  id="editPointItem_pointItem" name="editPointItem_pointItem">
                            <option [ngValue]="null" disabled="true">Select a üçç Award</option>
                            <ng-container *ngFor="let pointItem of pointItems">
                              <option  [ngValue]="pointItem">
                                {{pointItem.name}} {{pointItem.amount}}üçç
                              </option>
                            </ng-container>

                          </select>
                          <ng-container *ngIf="(editPointItemFormSubmitted && editPointItemForm.controls.pointItem.invalid) || (editPointItemForm.dirty && editPointItemForm.controls.pointItem.touched && editPointItemForm.controls.pointItem.invalid)">
                            <label class="validation-message">This field is required.</label>
                          </ng-container>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-sm-12 col-md-6 col-lg-6 col-xl-6 text-dark text-left" >
                          <label for="editPointItem_name" class="l2">üçç Award Name</label>
                          <input type="text" class="form-control pointItem-form-control text-dark text-left" formControlName="name"  id="editPointItem_name" placeholder="Point Item Name">
                          <ng-container *ngIf="(editPointItemFormSubmitted && editPointItemForm.controls.name.invalid) || (editPointItemForm.dirty && editPointItemForm.controls.name.touched && editPointItemForm.controls.name.invalid)">
                            <label class="validation-message">This field is required.</label>
                          </ng-container>
                        </div>
                        <div class="form-group col-sm-12 col-md-6 col-lg-6 col-xl-6 text-dark text-left">
                          <label for="editPointItem_amount" class="l2">üçç Amount</label>
                          <input type="text" class="form-control pointItem-form-control text-dark text-left" formControlName="amount" id="editPointItem_amount" placeholder="Point Amount">
                          <ng-container *ngIf="(editPointItemFormSubmitted && editPointItemForm.controls.amount.invalid) || (editPointItemForm.dirty && editPointItemForm.controls.amount.touched && editPointItemForm.controls.amount.invalid)">
                            <label class="validation-message">This field is required.</label>
                          </ng-container>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-12 text-dark text-left">
                          <label for="editPointItem_description">Description</label>
                          <input type="text" class="form-control pointItem-form-control text-dark text-left" formControlName="description" id="editPointItem_description" placeholder="Description">
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="col-12 text-dark">
                          <label>Core Values</label>
                          <div class="form-group" formGroupName="coreValuesGroup">
                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="editPointItem_checkbox_happy" formControlName="coreValue_happy">Happy
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="editPointItem_checkbox_fun" formControlName="coreValue_fun">Fun
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="editPointItem_checkbox_genuine" formControlName="coreValue_genuine">Genuine
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="editPointItem_checkbox_caring" formControlName="coreValue_caring">Caring
                                <span class="form-check-sign"></span>
                              </label>
                            </div>

                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="editPointItem_checkbox_respect" formControlName="coreValue_respect">Respect
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                            <div class="form-check form-check-inline">
                              <label class="form-check-label text-dark">
                                <input class="form-check-input" type="checkbox" id="editPointItem_checkbox_honest" formControlName="coreValue_honest">Honest
                                <span class="form-check-sign"></span>
                              </label>
                            </div>
                            <div *ngIf="(editPointItemFormSubmitted && editPointItemForm.controls['coreValuesGroup'].errors?.requireCheckboxesToBeChecked) || (editPointItemForm.dirty && editPointItemForm.controls['coreValuesGroup'].errors && editPointItemForm.controls['coreValuesGroup'].errors?.requireCheckboxesToBeChecked)">
                              <label class="validation-message">Please select at least one Core Value.</label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </perfect-scrollbar>

              </ng-container>

              <ng-container *ngIf="currentManagePointItemView === 'deletePointItem'">

                <!-- Delete Point Item -->
                <perfect-scrollbar class="scroll-container" fxFlex="auto" [config]="config" [scrollIndicators]="false">
                  <div class="pointItem-form-container">
                    <form [formGroup]="deletePointItemForm">
                      <div class="form-row">
                        <div class="form-group col-sm-12 col-md-6 col-lg-6 col-xl-6 text-dark text-left">
                          <label for="deletePointItem_pointItem" class="form-label">Select a üçç Award to Delete</label>
                          <select formControlName="pointItem"
                                  class="form-control pointItem-form-control text-dark"
                                  id="deletePointItem_pointItem" name="deletePointItem_pointItem">
                            <option [ngValue]="null" [disabled]="true">Select a üçç Award</option>
                            <ng-container *ngFor="let pointItem of pointItems" >
                              <option [ngValue]="pointItem">
                                {{pointItem.name}} {{pointItem.amount}}üçç
                              </option>
                            </ng-container>

                          </select>
                          <ng-container *ngIf="(deletePointItemFormSubmitted && deletePointItemForm.controls.pointItem.invalid) || (deletePointItemForm.dirty && deletePointItemForm.controls.pointItem.touched && deletePointItemForm.controls.pointItem.invalid)">
                            <label class="validation-message">This field is required.</label>
                          </ng-container>
                        </div>
                      </div>
                    </form>
                  </div>
                </perfect-scrollbar>

              </ng-container>
            </div>

          </div>



        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <ng-container *ngIf="currentManagePointItemView === 'addPointItem'">
            <button type="button" class="btn btn-primary" (click)="onAddPointItemFormSubmit(addPointItemForm)">Save Changes</button>
          </ng-container>
          <ng-container *ngIf="currentManagePointItemView === 'editPointItem'">
            <button type="button" class="btn btn-primary" (click)="onEditPointItemFormSubmit(editPointItemForm)">Save Changes</button>
          </ng-container>
          <ng-container *ngIf="currentManagePointItemView === 'deletePointItem'">
            <button type="button" class="btn btn-primary" (click)="onDeletePointItemFormSubmit(deletePointItemForm)">Delete Point Item</button>
          </ng-container>

        </div>
      </div>
    </div>
  </div>

</ng-container>

<ng-template #cardLoading>
  <div class="card-body">
    <ngx-spinner name="gift-points-spinner" [fullScreen]="false" bdColor="rgba(51,51,51,0.8)" size="medium"
                 color="#fff" type="pacman">
      <p class="loading">Loading...</p>
    </ngx-spinner>
  </div>
</ng-template>

<!-- Placeholder for loading avatar -->
<ng-template #avatarLoading>
  <div>
    <img src="https://placeholder.pics/svg/100x100/DEDEDE/555555/%20" alt="Loading..." class="img-row">
  </div>
</ng-template>
