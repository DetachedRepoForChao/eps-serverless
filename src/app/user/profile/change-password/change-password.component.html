<div *ngIf="!isCardLoading; else cardLoading">
  <div class="row">
    <div class="col-3 text-left margintop">
      <div>
        <div *ngIf="(currentUser$ | async)[0]?.preferredName; else noPreferredName">
          <h4 class="text-uppercase">{{(currentUser$ | async)[0]?.preferredName}}</h4>
        </div>
        <ng-template #noPreferredName>
          <h4 class="text-uppercase">{{(currentUser$ | async)[0]?.firstName}} {{(currentUser$ | async)[0]?.lastName}}</h4>
        </ng-template>

        <span>{{(currentUser$ | async)[0]?.department.Name}}</span>

      </div>

    </div>
    <div class="col-4 text-left zeropadding">
      <div *ngIf="this.currentUserQuery.getCurrentUser()[0]; else avatarLoading">
        <img [src]="this.currentUserQuery.getCurrentUser()[0]?.avatarResolvedUrl"
             alt="Avatar"
             class="img-center img-fluid rounded-circle"
             id="avatar"
             (click)="avatarClick()">
      </div>

      <ng-template #avatarLoading >
        <img src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="
             alt="Loading..."
             class="img-center img-fluid rounded-circle"
             id="avatarPlaceholder">
      </ng-template>
      <hr class="line-success">
    </div>
    <div class="col-5 avatarstyle">
      <div [matTooltip]="'Points: ' + (currentUser$ | async)[0]?.points + '&#13;Pending Balance: ' + (getPendingBalance() | async)"
           matTooltipPosition="above">
        <div class="row">
          <div class="col-5">
            <div class="mb-1 line-height-3 font-weight-200" >Points:</div>
          </div>
          <div class="col-4">
            <div *ngIf="(currentUser$ | async)[0]?.pointsBalance === 0; else pointsWithBalance">
              <div class="mb-0">{{(currentUser$ | async)[0]?.points}}</div>
            </div>
            <ng-template #pointsWithBalance >
              <div *ngIf="(currentUser$ | async)[0]?.points - (currentUser$ | async)[0]?.pointsBalance"
                   class="mb-0 red"
              >
                {{(currentUser$ | async)[0]?.points - (currentUser$ | async)[0]?.pointsBalance}}
              </div>

            </ng-template>
          </div>
        </div>

      </div>
      <div class="row">
        <div class="col-5">
          <div class="mb-1 line-height-3 font-weight-200">Trophies:</div>
        </div>
        <div class="col-4">
          <div class="mb-0" *ngIf="achievementQuery.getFinishedAchievements() && achievementQuery.getAll()">
            {{achievementQuery.getFinishedAchievements().length}} / {{achievementQuery.getAll().length}}
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-5">
          <div class="mb-1 line-height-3 font-weight-200">Rank:</div>
        </div>
        <div class="col-4">
          <div class="mb-0" *ngIf="(userQuery.selectLoading() | async) === false">
            {{(leaderboardUsers$ | async).indexOf((userQuery.getUser(globals.getUsername()) | async)[0]) + 1}}
          </div>
        </div>
      </div>
    </div>

  </div>
  <div class="row">
    <div class="user-form-container col-12">
      <form [formGroup]="changePasswordForm">
        <div>
          <div class="form-row">
            <div class="col-4 aligncentercontent">
              <label for="changePassword_currentPassword" class="form-label">Current Password</label>
            </div>
            <div class="col-6">
              <input type="password" class="form-control user-form-control" id="changePassword_currentPassword" placeholder="Current Password" formControlName="currentPassword">
              <div *ngIf="(changePasswordFormSubmitted && changePasswordForm?.controls.currentPassword.invalid) || (changePasswordForm?.dirty && changePasswordForm?.controls.currentPassword.touched && changePasswordForm?.controls.currentPassword.invalid)">
                <label class="validation-message">This field is required.</label>
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="col-4 aligncentercontent">
              <label for="changePassword_newPassword" class="form-label">New Password</label>
            </div>
            <div class="col-6">
              <input type="password" class="form-control user-form-control" id="changePassword_newPassword" placeholder="New Password" formControlName="newPassword">
              <div *ngIf="(changePasswordFormSubmitted && changePasswordForm?.controls.newPassword.invalid) || (changePasswordForm?.dirty && changePasswordForm?.controls.newPassword.touched && changePasswordForm?.controls.newPassword.invalid)">
                <label class="validation-message">This field is required.</label>
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="col-4 aligncentercontent">
              <label for="changePassword_confirmPassword" class="form-label">Confirm Password</label>
            </div>
            <div class="col-6">
              <input type="password" class="form-control user-form-control" id="changePassword_confirmPassword" placeholder="Confirm Password" formControlName="confirmPassword">
              <div *ngIf="(changePasswordFormSubmitted && (changePasswordForm?.errors?.mismatchedPasswords === true)) || (changePasswordForm?.dirty && changePasswordForm?.controls.confirmPassword.touched && (changePasswordForm?.errors?.mismatchedPasswords === true))">
                <label class="validation-message">Passwords don't match.</label>
              </div>
              <div *ngIf="(changePasswordFormSubmitted && (changePasswordForm?.controls.confirmPassword.invalid)) || (changePasswordForm?.dirty && changePasswordForm?.controls.confirmPassword.touched && changePasswordForm?.controls.confirmPassword.invalid)">
                <label class="validation-message">This field is required.</label>
              </div>
            </div>
          </div>

        </div>

      </form>
      <button type="button" class="btn btn-primary" (click)="onChangePasswordFormSubmit(changePasswordForm)">Change Password</button>

    </div>
  </div>
</div>

<ng-template #cardLoading>
  <ngx-spinner
    name="change-password-spinner"
    [fullScreen]="true"
    bdColor="rgba(51,51,51,0.8)"
    size="medium"
    color="#fff"
    type="pacman"
  >
    <p class="loadingstyle">Loading...</p>
  </ngx-spinner>
</ng-template>


<div class="modal fade modal-black" id="avatarModal" role="dialog" tabindex="-1" aria-labelledby="avatarModalLabel" aria-hidden="true" >
  <div class="modal-dialog modal-lg" role="document">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Choose Your Avatar</h4>
      </div>
      <!---modal body---->
      <div class="modal-body" *ngIf="this.currentUserQuery.getCurrentUser()[0]; else avatarModalLoading">
        <app-avatar [avatarUrl]="this.currentUserQuery.getCurrentUser()[0]?.avatarResolvedUrl"></app-avatar>
      </div>
      <ng-template #avatarModalLoading>

      </ng-template>
      <!----End Mod Bod---->

    </div>
  </div>
</div>


