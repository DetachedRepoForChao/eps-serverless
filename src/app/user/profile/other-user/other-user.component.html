<div class="wrapper">

  <section class="section section-lg section-coins">
    <img src="../../../assets/img/path3.png" class="path">
    <div class="container align-items-center wrapperwidth">
      <div class="row" >
        <div class="col-lg-12 col-md-6 col-sm-10 ml-auto mr-auto" id="profile">

          <div class="card">
            <div class="card card-coin card-plain card-custom">

              <div class="card-body" >
                <div class="row">
                  <div class="col-4">
                    <div class="row">
                      <div class="col-12">
                        <div *ngIf="this.user$; else avatarLoading">
                          <img [src]="(this.user$ | async)[0]?.avatarResolvedUrl"
                               alt="Avatar"
                               class="img-center img-fluid rounded-circle"
                               id="avatar">
                        </div>

                        <ng-template #avatarLoading >
                          <img src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="
                               alt="Loading..."
                               class="img-center img-fluid rounded-circle"
                               id="avatarPlaceholder">
                        </ng-template>
                      </div>
                    </div>

                    <div class="row text-center mt-4">
                      <div class="col p-2">
                        <h3 class="mb-1 line-height-5 font-weight-bold">Points</h3>
                        <h4 class="mb-0">{{(user$ | async)[0]?.points}}</h4>
                      </div>
                      <div class="col p-2">
                        <h3 class="mb-1 line-height-5 font-weight-bold">Trophies</h3>
                        <h4 class="mb-0">{{userQuery.getUserCompleteAchievementCount((user$ | async)[0]?.userId).length}} / {{achievementQuery.getAll().length}}</h4>
                      </div>
                      <div class="col p-2">
                        <h3 class="mb-1 line-height-5 font-weight-bold">Rank</h3>
                        <h4 class="mb-0">{{(leaderboardUsers$ | async).indexOf((user$ | async)[0]) + 1}}</h4>
                      </div>
                    </div>
                  </div>

                  <div class="col-8">

                    <div class="row">
                      <div class="user-form-container col-12">
                        <form>
                          <div *ngIf="isUserDataRetrieved; else placeholderForm">
                            <div class="form-row">
                              <div class="col-3 aligncentercontent">
                                <label class="form-label">Name</label>
                              </div>
                              <div class="col-7">
                                <div *ngIf="(user$ | async)[0]?.preferredName; else noPreferredName">
                                  <h4 class="user-attribute">{{(user$ | async)[0]?.preferredName}}</h4>
                                </div>
                                <ng-template #noPreferredName>
                                  <h4 class="user-attribute">{{(user$ | async)[0]?.firstName}} {{(user$ | async)[0]?.lastName}}</h4>
                                </ng-template>
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3">
                                <label class="form-label">Department</label>
                              </div>
                              <div class="col-7">
                                <h4 class="user-attribute">{{(user$ | async)[0]?.department.Name}}</h4>
                              </div>
                            </div>
                            <div *ngIf="(user$ | async)[0]?.birthdate" class="form-row">
                              <div class="col-3">
                                <label class="form-label">Date of Birth</label>
                              </div>
                              <div class="col-7">
                                <div *ngIf="(user$ | async)[0]?.birthdatePublic; else fieldPrivate">
                                  <h4 class="user-attribute">{{(user$ | async)[0]?.birthdate}}</h4>
                                </div>
                              </div>
                            </div>
                            <div *ngIf="(user$ | async)[0]?.email" class="form-row">
                              <div class="col-3">
                                <label class="form-label">Email</label>
                              </div>
                              <div class="col-7">
                                <div *ngIf="(user$ | async)[0]?.emailPublic; else fieldPrivate">
                                  <h4 class="user-attribute">{{(user$ | async)[0]?.email}}</h4>
                                </div>
                              </div>
                            </div>
                            <div *ngIf="(user$ | async)[0]?.phone" class="form-row">
                              <div class="col-3">
                                <label class="form-label">Phone</label>
                              </div>
                              <div class="col-7">
                                <div *ngIf="(user$ | async)[0]?.phonePublic; else fieldPrivate">
                                  <h4 class="user-attribute">{{(user$ | async)[0]?.phone}}</h4>
                                </div>
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3">
                                <label class="form-label">Favorite Quote</label>
                              </div>
                              <div class="col-7">
                                <div *ngIf="(user$ | async)[0]?.quote; else noQuote">
                                  <h4 class="user-attribute">{{(user$ | async)[0]?.quote}}</h4>
                                </div>
                                <ng-template #noQuote>
                                  <h4 class="user-attribute">Nothing here yet...</h4>
                                </ng-template>
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3">
                                <label class="form-label">Gender</label>
                              </div>
                              <div class="col-7">
                                <div *ngIf="(user$ | async)[0]?.genderPublic; else fieldPrivate">
                                  <h4 *ngIf="(user$ | async)[0]?.gender" class="user-attribute">{{(user$ | async)[0]?.gender}}</h4>
                                </div>
                              </div>
                            </div>

                            <!--<div class="form-row">
                              <div class="col-2 aligncentercontent">
                                <label class="form-label">Email</label>
                              </div>
                              <div class="confirm-col text-right col-1">
                                <div *ngIf="emailConfirmed; else emailUnconfirmedIcon">
                                  <i class="fas fa-check confirmed"></i>
                                </div>
                                <ng-template #emailUnconfirmedIcon>
                                  <i class="fas fa-times unconfirmed"></i>
                                </ng-template>
                              </div>
                              <div *ngIf="emailConfirmed; else emailUnconfirmedInput" class="col-7">
                                <input type="email" class="form-control user-form-control" id="editUser_confirmedEmail" placeholder="Email" formControlName="email">
                                <div *ngIf="(editUserFormSubmitted && editUserForm?.controls.email.invalid) || (editUserForm?.dirty && editUserForm?.controls.email.touched && editUserForm?.controls.email.invalid)">
                                  <label class="validation-message">This field is required.</label>
                                </div>
                              </div>
                              <ng-template #emailUnconfirmedInput class="col-5">
                                <div class="col-5">
                                  <input type="email" class="form-control user-form-control" id="editUser_unconfirmedEmail" placeholder="Email" formControlName="email">
                                  <div *ngIf="(editUserFormSubmitted && editUserForm?.controls.email.invalid) || (editUserForm?.dirty && editUserForm?.controls.email.touched && editUserForm?.controls.email.invalid)">
                                    <label class="validation-message">This field is required.</label>
                                  </div>
                                </div>
                              </ng-template>
                              <div *ngIf="!emailConfirmed" class="confirm-col col-2">
                                <button class="btn-primary btn-sm" data-toggle="modal" data-target="#confirmEmailModal" (click)="onEmailConfirmClick()">Confirm</button>
                              </div>
                            </div>

                            <div class="form-row">
                              <div class="col-2 aligncentercontent">
                                <label class="form-label">Phone</label>
                              </div>
                              <div class="confirm-col text-right col-1">
                                <div *ngIf="phoneConfirmed; else phoneUnconfirmedIcon">
                                  <i class="fas fa-check confirmed"></i>
                                </div>
                                <ng-template #phoneUnconfirmedIcon>
                                  <i class="fas fa-times unconfirmed"></i>
                                </ng-template>
                              </div>
                              <div *ngIf="phoneConfirmed; else phoneUnconfirmedInput" class="col-7">
                                <input class="form-control user-form-control"
                                       placeholder="Phone"
                                       formControlName="phone"
                                       name="editUser_confirmedPhone"
                                       appPhoneMask
                                       type="tel"
                                       maxLength="14"
                                       [ngClass]="{'invalid-textbox' : editUserForm?.dirty && editUserForm?.controls.phone.touched && editUserForm?.controls.phone.invalid}"
                                       id="editUser_confirmedPhone">
                                <div *ngIf="(editUserFormSubmitted && editUserForm?.controls.phone.invalid) || (editUserForm?.dirty && editUserForm?.controls.phone.touched && phoneValidationError)">
                                  <label class="validation-message">This field is required.</label>
                                  <label *ngIf="phoneValidationError" class="validation-message">{{phoneValidationError}}</label>
                                </div>
                              </div>
                              <ng-template #phoneUnconfirmedInput class="col-5">
                                <div class="col-5">
                                  <input class="form-control user-form-control"
                                         placeholder="Phone"
                                         formControlName="phone"
                                         name="editUser_unconfirmedPhone"
                                         appPhoneMask
                                         type="tel"
                                         maxLength="14"
                                         [ngClass]="{'invalid-textbox' : editUserForm?.dirty && editUserForm?.controls.phone.touched && editUserForm?.controls.phone.invalid}"
                                         id="editUser_unconfirmedPhone">
                                  <div *ngIf="(editUserFormSubmitted && editUserForm?.controls.phone.invalid) || (editUserForm?.dirty && editUserForm?.controls.phone.touched && phoneValidationError)">
                                    <label class="validation-message">This field is required.</label>
                                    <label *ngIf="phoneValidationError" class="validation-message">{{phoneValidationError}}</label>
                                  </div>
                                </div>
                              </ng-template>
                              <div *ngIf="!phoneConfirmed" class="confirm-col col-2">
                                <button class="btn-primary btn-sm" data-toggle="modal" data-target="#confirmPhoneModal" (click)="onPhoneConfirmClick()">Confirm</button>
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3 aligncentercontent">
                                <label for="editUser_quote" class="form-label">Favorite Quote</label>
                              </div>
                              <div class="col-7">
                                <textarea rows="5" class="form-control user-form-control" id="editUser_quote" placeholder="Favorite Quote" formControlName="quote"></textarea>
                                <div *ngIf="editUserForm?.controls.quote.value && editUserForm?.controls.quote.valid">
                                  <label class="validation-message" id="quote-length-message">{{quoteLengthMax - editUserForm?.controls.quote.value.length}} characters remaining.</label>
                                </div>

                                <div *ngIf="(editUserFormSubmitted && editUserForm?.controls.quote.invalid) || (editUserForm?.controls.quote.touched && editUserForm?.controls.quote.invalid)">
                                  <label class="validation-message">Your quote must be 1000 characters or fewer in length.</label>
                                </div>
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3 aligncentercontent">
                                <label for="editUser_gender" class="form-label">Gender</label>
                              </div>
                              <div class="col-7">
                                <select formControlName="gender" class="form-control user-form-control" id="editUser_gender" name="editUser_gender">
                                  <option [ngValue]="null" [disabled]="true">Gender</option>
                                  <option class="black">Male</option>
                                  <option class="black">Female</option>
                                  <option class="black">Custom</option>
                                  <option class="black">Prefer Not to Say</option>
                                </select>
                                <div *ngIf="editUserForm.controls.gender.value === 'Custom'" class="row gender-custom-row">
                                  <div class="col-12">
                                    <input type="text" class="form-control user-form-control" id="editUser_customGender" placeholder="Gender" formControlName="genderCustom">
                                  </div>
                                </div>
                              </div>
                            </div>-->

                          </div>

                          <ng-template #placeholderForm>
                            <div class="form-row">
                              <div class="col-3 aligncentercontent">
                                <label for="editUser_phPreferredName" class="form-label">Preferred Name</label>
                              </div>
                              <div class="col-7">
                                <input type="text" class="form-control user-form-control" id="editUser_phPreferredName" placeholder="Preferred Name">
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3">
                                <label for="editUser_phBirthdate" class="form-label">Date of Birth</label>
                              </div>
                              <div class="col-7">
                                <input type="text"
                                       placeholder="Date of Birth"
                                       class="form-control user-form-control datepicker"
                                       id="editUser_phBirthdate">
                              </div>
                            </div>

                            <div class="form-row">
                              <div class="col-3 aligncentercontent">
                                <label class="form-label">Email</label>
                              </div>
                              <div class="col-7">
                                <input type="email" class="form-control user-form-control" id="editUser_phConfirmedEmail" placeholder="Email">
                              </div>

                            </div>

                            <div class="form-row">
                              <div class="col-3 aligncentercontent">
                                <label class="form-label">Phone</label>
                              </div>
                              <div class="col-7">
                                <input class="form-control user-form-control"
                                       placeholder="Phone"
                                       appPhoneMask
                                       type="tel"
                                       maxLength="14"
                                       id="editUser_phConfirmedPhone">
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3 aligncentercontent">
                                <label for="editUser_phGender" class="form-label">Gender</label>
                              </div>
                              <div class="col-7">
                                <input type="text" class="form-control user-form-control" id="editUser_phGender" placeholder="Gender">
                              </div>
                            </div>
                          </ng-template>

                        </form>

                      </div>
                    </div>
                  </div>

                </div>


              </div>
              <div class="card-footer text-center">
                <!-----Button----->
                <div class="container">
                  <div class="row">

                  </div>
                </div>
              </div>
            </div>

          </div>







        </div>
      </div>
    </div>
  </section>


</div>

<ng-template #fieldPrivate>
  <h4 class="user-attribute">Private</h4>
</ng-template>
