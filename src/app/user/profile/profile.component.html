<div class="index-page">
  <app-navigation></app-navigation>
  <div class="wrapper">
    <section class="section section-lg section-coins">
      <img src="../../../assets/img/path3.png" class="path">
      <div class="container align-items-center" style="max-width: 935px;">
        <div class="row" >
          <div class="col-lg-12 col-md-6 col-sm-10 ml-auto mr-auto" id="profile">

            <div class="card">
              <div class="card card-coin card-plain card-custom">
<!--                <div class="card-header">
                  <div *ngIf="this.currentUserQuery.getCurrentUserAvatar()[0]; else avatarLoading">
                    <img [src]="this.currentUserQuery.getCurrentUserAvatar()[0]?.avatarResolvedUrl"
                         alt="Avatar"
                         class="img-center img-fluid rounded-circle"
                         id="avatar"
                         (click)="avatarClick()">
                  </div>

                  <ng-template #avatarLoading >
                    <img src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="
                         alt="Loading..."
                         class="img-center img-fluid rounded-circle"
                         id="avatarPlaceholder">
                  </ng-template>
                </div>-->

                <div class="card-body" *ngIf="!isCardLoading; else cardLoading" >
                  <ngx-spinner
                    name="profile-card-spinner"
                    [fullScreen]="false"
                    bdColor="rgba(51,51,51,0.8)"
                    size="medium"
                    color="#fff"
                    type="pacman"
                  >
                    <p style="font-size: 20px; color: white">Loading...</p>
                  </ngx-spinner>

                  <div class="row">
                    <div class="col-4" style="text-align: left">
                      <ul class="nobullets">
                        <li>
                          Edit Profile
                        </li>
                        <li>
                          Edit Something Else
                        </li>
                        <li>
                          Edit Another Thing
                        </li>
                      </ul>
                    </div>
                    <div class="col-8">
                      <div class="row">
                        <div class="col-3 text-center" style="margin-top: 30px">
                          <div>
                            <h4 class="text-uppercase">{{(currentUser$ | async)[0]?.firstName}} {{(currentUser$ | async)[0]?.lastName}}</h4>
                            <span>{{(currentUser$ | async)[0]?.department.Name}}</span>
                            <hr class="line-success">
                          </div>

                        </div>
                        <div class="col-4 text-left" style="padding: 0px">
                          <div *ngIf="this.currentUserQuery.getCurrentUserAvatar()[0]; else avatarLoading">
                            <img [src]="this.currentUserQuery.getCurrentUserAvatar()[0]?.avatarResolvedUrl"
                                 alt="Avatar"
                                 class="img-center img-fluid rounded-circle"
                                 id="avatar"
                                 (click)="avatarClick()">
                          </div>

                          <ng-template #avatarLoading >
                            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="
                                 alt="Loading..."
                                 class="img-center img-fluid rounded-circle"
                                 id="avatarPlaceholder">
                          </ng-template>
                        </div>
                        <div class="col-5" style="margin-top: 30px; font-size: 16px">
                          <div [matTooltip]="'Points: ' + (currentUser$ | async)[0]?.points + '&#13;Pending Balance: ' + (getPendingBalance() | async)"
                               matTooltipPosition="above">
                            <div class="row">
                              <div class="col-5">
                                <div class="mb-1 line-height-3 font-weight-200" >Points:</div>
                              </div>
                              <div class="col-4">
                                <div *ngIf="(currentUser$ | async)[0]?.pointsBalance === 0; else pointsWithBalance">
                                  <div class="mb-0">{{(currentUser$ | async)[0]?.points}}</div>
                                </div>
                                <ng-template #pointsWithBalance >
                                  <div *ngIf="(currentUser$ | async)[0]?.points - (currentUser$ | async)[0]?.pointsBalance"
                                       class="mb-0"
                                       style="color: red">
                                    {{(currentUser$ | async)[0]?.points - (currentUser$ | async)[0]?.pointsBalance}}
                                  </div>

                                </ng-template>
                              </div>
                            </div>

                          </div>
                          <div class="row">
                            <div class="col-5">
                              <div class="mb-1 line-height-3 font-weight-200">Trophies:</div>
                            </div>
                            <div class="col-4">
                              <div class="mb-0" *ngIf="achievementQuery.getFinishedAchievements() && achievementQuery.getAll()">
                                {{achievementQuery.getFinishedAchievements().length}} / {{achievementQuery.getAll().length}}
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-5">
                              <div class="mb-1 line-height-3 font-weight-200">Rank:</div>
                            </div>
                            <div class="col-4">
                              <div class="mb-0" *ngIf="(userQuery.selectLoading() | async) === false">
                                {{(leaderboardUsers$ | async).indexOf((userQuery.getUser(globals.getUsername()) | async)[0]) + 1}}
                              </div>
                            </div>
                          </div>
                        </div>

                      </div>
                      <div class="row">
                        <div class="user-form-container col-12">

                          <form [formGroup]="editUserForm">
                            <div class="form-row">
                              <div class="col-3" style="align-content: center">
                                <label for="editUser_preferredName" class="form-label">Preferred Name</label>
                              </div>
                              <div class="col-7">
                                <input type="text" class="form-control user-form-control" id="editUser_preferredName" placeholder="Preferred Name" formControlName="preferredName">
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3">
                                <label for="editUser_birthdate" class="form-label">Date of Birth</label>
                              </div>
                              <div class="col-7">
                                <input type="text" [matDatepicker]="editUser_birthdate"
                                       (click)="editUser_birthdate.open()"
                                       placeholder="Date of Birth"
                                       formControlName="birthdate"
                                       class="form-control user-form-control datepicker"
                                       id="editUser_birthdate">

                                <mat-datepicker #editUser_birthdate [startView]="'year'"></mat-datepicker>
                                <div *ngIf="(editUserFormSubmitted && editUserForm.controls.birthdate.invalid) || (editUserForm.dirty && editUserForm.controls.birthdate.touched && editUserForm.controls.birthdate.invalid)">
                                  <label class="validation-message">This field is required.</label>
                                </div>
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3" style="align-content: center">
                                <label for="editUser_email" class="form-label">Email</label>
                              </div>
                              <div class="col-7">
                                <input type="email" class="form-control user-form-control" id="editUser_email" placeholder="Email" formControlName="email">
                                <div *ngIf="(editUserFormSubmitted && editUserForm.controls.email.invalid) || (editUserForm.dirty && editUserForm.controls.email.touched && editUserForm.controls.email.invalid)">
                                  <label class="validation-message">This field is required.</label>
                                </div>
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3" style="align-content: center">
                                <label for="editUser_phone" class="form-label">Phone</label>
                              </div>
                              <div class="col-7">
                                <input class="form-control user-form-control"
                                       placeholder="Phone"
                                       formControlName="phone"
                                       name="editUser_phone"
                                       appPhoneMask
                                       type="tel"
                                       maxLength="14"
                                       [ngClass]="{'invalid-textbox' : editUserForm.dirty && editUserForm.controls.phone.touched && editUserForm.controls.phone.invalid}"
                                       id="editUser_phone">
                                <div *ngIf="(editUserFormSubmitted && editUserForm.controls.phone.invalid) || (editUserForm.dirty && editUserForm.controls.phone.touched && phoneValidationError)">
                                  <label class="validation-message">This field is required.</label>
                                  <label *ngIf="phoneValidationError" class="validation-message">{{phoneValidationError}}</label>
                                </div>
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3" style="align-content: center">
                                <label for="editUser_gender" class="form-label">Gender</label>
                              </div>
                              <div class="col-7">
                                <input type="text" class="form-control user-form-control" id="editUser_gender" placeholder="Gender" formControlName="gender">
                              </div>
                            </div>

                            <div class="form-row">
                              <div class="col-3" style="align-content: center">
                                <label for="editUser_address1" class="form-label">Address 1</label>
                              </div>
                              <div class="col-7">
                                <input type="text" class="form-control user-form-control" id="editUser_address1" placeholder="Address 1" formControlName="address1">
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3" style="align-content: center">
                                <label for="editUser_address2" class="form-label">Address 2</label>
                              </div>
                              <div class="col-7">
                                <input type="text" class="form-control user-form-control" id="editUser_address2" placeholder="Address 2" formControlName="address2">
                              </div>
                            </div>

                            <div class="form-row">
                              <div class="col-3" style="align-content: center">
                                <label for="editUser_city" class="form-label">City</label>
                              </div>
                              <div class="col-7">
                                <input type="text" class="form-control user-form-control" id="editUser_city" placeholder="City" formControlName="city">
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3" style="align-content: center">
                                <label for="editUser_state" class="form-label">State</label>
                              </div>
                              <div class="col-7">
                                <input type="text" class="form-control user-form-control" id="editUser_state" placeholder="State" formControlName="state">
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3" style="align-content: center">
                                <label for="editUser_country" class="form-label">Country</label>
                              </div>
                              <div class="col-7">
                                <input type="text" class="form-control user-form-control" id="editUser_country" placeholder="Country" formControlName="country">
                              </div>
                            </div>
                            <div class="form-row">
                              <div class="col-3" style="align-content: center">
                                <label for="editUser_zip" class="form-label">Zip</label>
                              </div>
                              <div class="col-7">
                                <input type="text" class="form-control user-form-control" id="editUser_zip" placeholder="Zip" formControlName="zip">
                              </div>
                            </div>
                          </form>

                        </div>
                      </div>


                    </div>

                  </div>


                </div>
                <div class="card-footer text-center">
                  <!-----Button----->
                  <div class="container">
                    <div class="row">

                    </div>
                  </div>
                </div>
              </div>



              <!-- Blank card to display while loading -->
              <ng-template #cardLoading>
                <div class="card-body">
                  <ngx-spinner
                    name="profile-card-spinner"
                    [fullScreen]="false"
                    bdColor="rgba(51,51,51,0.8)"
                    size="medium"
                    color="#fff"
                    type="pacman"
                  >
                    <p style="font-size: 20px; color: white">Loading...</p>
                  </ngx-spinner>
                </div>
              </ng-template>

            </div>







          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<div class="modal fade modal-black" id="avatarModal" role="dialog" tabindex="-1" aria-labelledby="avatarModalLabel" aria-hidden="true" >
  <div class="modal-dialog modal-lg" role="document">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Choose Your Avatar</h4>
      </div>
      <!---modal body---->
      <div class="modal-body" *ngIf="this.currentUserQuery.getCurrentUserAvatar()[0]; else avatarModalLoading">
        <app-avatar [avatarUrl]="this.currentUserQuery.getCurrentUserAvatar()[0]?.avatarResolvedUrl"></app-avatar>
      </div>
      <ng-template #avatarModalLoading>

      </ng-template>
      <!----End Mod Bod---->

    </div>
  </div>
</div>




